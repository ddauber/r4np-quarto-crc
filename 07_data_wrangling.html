<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R for Non-Programmers: A Guide for Social Scientists - 7&nbsp; Data Wrangling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08_descriptive_statistics.html" rel="next">
<link href="./06_starting_r_projects.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./07_data_wrangling.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Wrangling</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R for Non-Programmers: A Guide for Social Scientists</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_about_the_author.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About the author</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_acknowledgements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgements</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_before_you_get_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title"><code>Readme.</code> before you get started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_why_start_learning_a_programming_language.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Why learn a programming language as a non-programmer?</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_setting_up_r_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Setting up <em>R</em> and RStudio</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_rstudio_interface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The RStudio Interface</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_r_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title"><em>R</em> Basics: The very fundamentals</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_starting_r_projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Starting your <em>R</em> projects</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_data_wrangling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_descriptive_statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Descriptive Statistics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_sources_of_bias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Sources of bias: Sampling, outliers, normality and other ‘conundrums’</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_correlations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Correlations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_group_comparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Comparing groups</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_power_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Power: You either have it or you don’t</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_regressions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Regression: Creating models to predict future observations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_mixed_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Mixed-methods research: Analysing qualitative data in <em>R</em></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_next_steps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Where to go from here: The next steps in your <em>R</em> journey</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18_epilogue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Epilogue</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_appendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-import-your-data" id="toc-sec-import-your-data" class="nav-link active" data-scroll-target="#sec-import-your-data"><span class="header-section-number">7.1</span> Import your data</a>
  <ul class="collapse">
  <li><a href="#import-data-from-the-files-pane" id="toc-import-data-from-the-files-pane" class="nav-link" data-scroll-target="#import-data-from-the-files-pane"><span class="header-section-number">7.1.1</span> Import data from the <em>Files</em> pane</a></li>
  <li><a href="#sec-importing-data-from-the-environment-pane" id="toc-sec-importing-data-from-the-environment-pane" class="nav-link" data-scroll-target="#sec-importing-data-from-the-environment-pane"><span class="header-section-number">7.1.2</span> Importing data from the <em>Environment</em> pane</a></li>
  <li><a href="#sec-importing-data-using-functions" id="toc-sec-importing-data-using-functions" class="nav-link" data-scroll-target="#sec-importing-data-using-functions"><span class="header-section-number">7.1.3</span> Importing data using functions directly</a></li>
  </ul></li>
  <li><a href="#sec-inspecting-raw-data" id="toc-sec-inspecting-raw-data" class="nav-link" data-scroll-target="#sec-inspecting-raw-data"><span class="header-section-number">7.2</span> Inspecting your data</a></li>
  <li><a href="#sec-colnames-cleaning" id="toc-sec-colnames-cleaning" class="nav-link" data-scroll-target="#sec-colnames-cleaning"><span class="header-section-number">7.3</span> Cleaning your column names: Call the <code>janitor</code></a></li>
  <li><a href="#sec-change-data-types" id="toc-sec-change-data-types" class="nav-link" data-scroll-target="#sec-change-data-types"><span class="header-section-number">7.4</span> Data types: What are they and how can you change them</a></li>
  <li><a href="#sec-handling-factors" id="toc-sec-handling-factors" class="nav-link" data-scroll-target="#sec-handling-factors"><span class="header-section-number">7.5</span> Handling factors</a>
  <ul class="collapse">
  <li><a href="#sec-recoding-factors" id="toc-sec-recoding-factors" class="nav-link" data-scroll-target="#sec-recoding-factors"><span class="header-section-number">7.5.1</span> Recoding factors</a></li>
  <li><a href="#sec-reordering-factor-levels" id="toc-sec-reordering-factor-levels" class="nav-link" data-scroll-target="#sec-reordering-factor-levels"><span class="header-section-number">7.5.2</span> Reordering factor levels</a></li>
  <li><a href="#sec-removing-factor-levels" id="toc-sec-removing-factor-levels" class="nav-link" data-scroll-target="#sec-removing-factor-levels"><span class="header-section-number">7.5.3</span> Removing factor levels</a></li>
  </ul></li>
  <li><a href="#sec-handling-dates-times-and-durations" id="toc-sec-handling-dates-times-and-durations" class="nav-link" data-scroll-target="#sec-handling-dates-times-and-durations"><span class="header-section-number">7.6</span> Handling dates, times and durations</a>
  <ul class="collapse">
  <li><a href="#sec-converting-dates-and-times-for-analysis" id="toc-sec-converting-dates-and-times-for-analysis" class="nav-link" data-scroll-target="#sec-converting-dates-and-times-for-analysis"><span class="header-section-number">7.6.1</span> Converting dates and times for analysis</a></li>
  <li><a href="#sec-computation-dates-times" id="toc-sec-computation-dates-times" class="nav-link" data-scroll-target="#sec-computation-dates-times"><span class="header-section-number">7.6.2</span> Computing durations with dates, times and date-time variables</a></li>
  </ul></li>
  <li><a href="#sec-dealing-with-missing-data" id="toc-sec-dealing-with-missing-data" class="nav-link" data-scroll-target="#sec-dealing-with-missing-data"><span class="header-section-number">7.7</span> Dealing with missing data</a>
  <ul class="collapse">
  <li><a href="#sec-mapping-missing-data" id="toc-sec-mapping-missing-data" class="nav-link" data-scroll-target="#sec-mapping-missing-data"><span class="header-section-number">7.7.1</span> Mapping missing data</a></li>
  <li><a href="#sec-patterns-of-missing-data" id="toc-sec-patterns-of-missing-data" class="nav-link" data-scroll-target="#sec-patterns-of-missing-data"><span class="header-section-number">7.7.2</span> Identifying patterns of missing data</a></li>
  <li><a href="#sec-replacing-removing-missing-data" id="toc-sec-replacing-removing-missing-data" class="nav-link" data-scroll-target="#sec-replacing-removing-missing-data"><span class="header-section-number">7.7.3</span> Replacing or removing missing data</a></li>
  <li><a href="#sec-two-more-methods-of-replacing-missing-data" id="toc-sec-two-more-methods-of-replacing-missing-data" class="nav-link" data-scroll-target="#sec-two-more-methods-of-replacing-missing-data"><span class="header-section-number">7.7.4</span> Two more methods of replacing missing data you hardly ever need</a></li>
  <li><a href="#sec-main-takeaways-missing-data" id="toc-sec-main-takeaways-missing-data" class="nav-link" data-scroll-target="#sec-main-takeaways-missing-data"><span class="header-section-number">7.7.5</span> Main takeaways regarding dealing with missing data</a></li>
  </ul></li>
  <li><a href="#sec-latent-constructs" id="toc-sec-latent-constructs" class="nav-link" data-scroll-target="#sec-latent-constructs"><span class="header-section-number">7.8</span> Latent constructs and their reliability</a>
  <ul class="collapse">
  <li><a href="#sec-computing-latent-variables" id="toc-sec-computing-latent-variables" class="nav-link" data-scroll-target="#sec-computing-latent-variables"><span class="header-section-number">7.8.1</span> Computing latent variables</a></li>
  <li><a href="#sec-internal-consistency" id="toc-sec-internal-consistency" class="nav-link" data-scroll-target="#sec-internal-consistency"><span class="header-section-number">7.8.2</span> Checking internal consistency of items measuring a latent variable</a></li>
  <li><a href="#sec-efa-and-cfa" id="toc-sec-efa-and-cfa" class="nav-link" data-scroll-target="#sec-efa-and-cfa"><span class="header-section-number">7.8.3</span> Confirmatory factor analysis</a></li>
  <li><a href="#sec-reversing-items-with-opposite-meaning" id="toc-sec-reversing-items-with-opposite-meaning" class="nav-link" data-scroll-target="#sec-reversing-items-with-opposite-meaning"><span class="header-section-number">7.8.4</span> Reversing items with opposite meaning</a></li>
  </ul></li>
  <li><a href="#sec-conclusion-data-wrangling" id="toc-sec-conclusion-data-wrangling" class="nav-link" data-scroll-target="#sec-conclusion-data-wrangling"><span class="header-section-number">7.9</span> Once you finished with data wrangling</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">7.10</span> Exercises</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-PF1VJZVM7C"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PF1VJZVM7C');
</script>

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-data-wrangling" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<p><strong>Data wrangling</strong> — also called&nbsp;<strong>data cleaning</strong>,&nbsp;<strong>data remediation</strong>, or&nbsp;<strong>data munging</strong>—refers to a variety of processes designed to transform raw data into more readily used formats. The exact methods differ from project to project depending on the data you’re leveraging and the goal you’re trying to achieve. <span class="citation" data-cites="hsbDataWrangling">(<a href="references.html#ref-hsbDataWrangling" role="doc-biblioref">Stobierski 2021</a>)</span></p>
</blockquote>
<p>You collected your data over months (and sometimes years), and all you want to know is whether your data makes sense and reveals something nobody would have ever expected. However, before we can truly go ahead with our analysis, it is essential to understand whether our data is ‘tidy’. What I mean is that our data is at the quality we would expect it to be and can be reliably used for data analysis. After all, the results of our research are only as good as our data and the methods we deploy to achieve the desired insights.</p>
<p>Very often, the data we receive is everything else but clean, and we need to check whether our data is fit for analysis and ensure it is in a format that is easy to handle. For small datasets, this is usually a brief exercise. However, I found myself cleaning data for a month because the dataset was spread out into multiple spreadsheets with different numbers of columns and odd column names that were not consistent. Thus, data wrangling is an essential first step in any data analysis. It is a step that cannot be skipped and has to be performed on every new dataset. If your background is in qualitative research, you likely conducted interviews which you had to transcribe. The process of creating transcriptions is comparable to data wrangling in quantitative datasets - and equally tedious.</p>
<p>Luckily, <em>R</em> provides many useful functions to make our lives easier. You will be in for a treat if you are like me and used to do this in Excel. It is a lot simpler using <em>R</em> to achieve a clean dataset.</p>
<p>Here is an overview of the different steps we usually work through before starting with our primary analysis. This list is certainly not exhaustive:</p>
<ul>
<li><p>Import data,</p></li>
<li><p>Check data types,</p></li>
<li><p>Recode and arrange factors, i.e.&nbsp;categorical data, and</p></li>
<li><p>Run missing data diagnostics.</p></li>
</ul>
<section id="sec-import-your-data" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="sec-import-your-data"><span class="header-section-number">7.1</span> Import your data</h2>
<p>The <code>r4np</code> package hosts several different datasets to work with, but at some point, you might want to apply your <em>R</em> knowledge to your own data. Therefore, an essential first step is to import your data into RStudio. There are three different methods, all of which are very handy:</p>
<ol type="1">
<li><p>Click on your data file in the <em>Files</em> pane and choose <code>Import Dataset</code>.</p></li>
<li><p>Use the <code>Import Dataset</code> button in the <em>Environment</em> pane.</p></li>
<li><p>Import your data calling one of the <code>readr</code> functions in the <em>Console</em> or <em>R</em> script.</p></li>
</ol>
<p>We will use the <code>readr</code> package for all three options. Using this package we can import a range of different file formats, including <code>.csv</code>, <code>.tsv</code>, <code>.txt</code>. If you want to import data from an <code>.xlsx</code> file, you need to use another package called <code>readxl</code>. Similarly, if you used SPSS, Stata or SAS files before and want to use them in <em>R</em> you can use the <code>haven</code> package. The following sections will primarily focus on using <code>readr</code> via RStudio or directly in your <em>Console</em> or <em>R</em> script.</p>
<section id="import-data-from-the-files-pane" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1" class="anchored" data-anchor-id="import-data-from-the-files-pane"><span class="header-section-number">7.1.1</span> Import data from the <em>Files</em> pane</h3>
<p>This approach is by far the easiest. Let’s assume you have a dataset called <code>gender_age.csv</code> in your <code>00_raw_data</code> folder. If you wish to import it, you can do the following:</p>
<ol type="1">
<li><p>Click on the name of the file.</p></li>
<li><p>Select <code>Import Dataset</code>.</p>
<p><img src="images/chapter_07_img/01_files_pane_import/01_files_pane_import.png" class="img-fluid"></p></li>
<li><p>A new window will open, and you can choose different options. You also see a little preview of how the data looks like. This is great if you are not sure whether you did it correctly.</p>
<p><img src="images/chapter_07_img/01_files_pane_import/02_files_pane_import.png" class="img-fluid"></p></li>
<li><p>You can change how data should be imported, but the default should be fine in most cases. Here is a quick breakdown of the most important options:</p>
<ul>
<li><p><code>Name</code> allows you to change the object name, i.e.&nbsp;the name of the object this data will be assigned to. I often use <code>df_raw</code> (<code>df</code> stand for <code>data frame</code>, which is how <em>R</em> calls such rectangular datasets).</p></li>
<li><p><code>Skip</code> is helpful if your data file starts with several empty rows at the top. You can remove them here.</p></li>
<li><p><code>First Row as Names</code> is ticked by default. In most Social Science projects, we tend to have the name of the variables as the first row in our dataset.</p></li>
<li><p><code>Trim Spaces</code> removes any unnecessary whitespace in your dataset. Leave it ticked.</p></li>
<li><p><code>Open Data Viewer</code> allows you to look at your imported dataset. I use it rarely, but it can be helpful at times.</p></li>
<li><p><code>Delimiter</code> defines how your columns are separated from each other in your file. If it is a <code>.csv</code> file, it would imply it is a ‘comma-separated value’, i.e.&nbsp;<code>,</code>. This setting can be changed for different files, depending on how your data is delimited. You can even use the option <code>Other…</code> to specify a custom separation option.</p></li>
<li><p><code>NA</code> specifies how missing values in your data are acknowledged. By default, empty cells in your data will be recognised as missing data.</p></li>
</ul>
<p><img src="images/chapter_07_img/01_files_pane_import/03_files_pane_import.png" class="img-fluid"></p></li>
<li><p>Once you are happy with your choices, you can click on <code>Import</code>.</p></li>
<li><p>You will find your dataset in the <em>Environment</em> pane.</p>
<p><img src="images/chapter_07_img/01_files_pane_import/04_files_pane_import.png" class="img-fluid"></p></li>
</ol>
<p>In the <em>Console</em>, you can see that <em>R</em> also provides the <code>Column specification</code>, which we need later when inspecting ‘data types’. <code>readr</code> automatically imports all text-based columns as <code>chr</code>, i.e.&nbsp;<code>character</code> values. However, this might not always be the correct data type. We will cover more of this aspect of data wrangling in <a href="#sec-change-data-types" class="quarto-xref"><span>Section 7.4</span></a>.</p>
</section>
<section id="sec-importing-data-from-the-environment-pane" class="level3" data-number="7.1.2">
<h3 data-number="7.1.2" class="anchored" data-anchor-id="sec-importing-data-from-the-environment-pane"><span class="header-section-number">7.1.2</span> Importing data from the <em>Environment</em> pane</h3>
<p>The process of importing datasets from the <em>Environment</em> pane follows largely the one from the <em>Files</em> pane. Click on <code>Import Dataset &gt; From Text (readr)…</code>. The only main difference lies in having to find the file using the <code>Browse…</code> button. The rest of the steps are the same as above.</p>
<p>Be aware that you will have to use the <em>Environment</em> pane for importing data from specific file types, e.g.&nbsp;<code>.txt</code>. The <em>File</em> pane would only open the file but not import the data for further processing.</p>
</section>
<section id="sec-importing-data-using-functions" class="level3" data-number="7.1.3">
<h3 data-number="7.1.3" class="anchored" data-anchor-id="sec-importing-data-using-functions"><span class="header-section-number">7.1.3</span> Importing data using functions directly</h3>
<p>If you organised your files well, it could be effortless and quick to use all the functions from <code>readr</code> directly. Here are two examples of how you can use <code>readr</code> to import your data. Make sure you have the package loaded.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data from '.csv'</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="st">"00_raw_data/gender_age.csv"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data from any text file by defining the separator</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">read_delim</span>(<span class="st">"00_raw_data/gender_age.txt"</span>, <span class="at">delim =</span> <span class="st">"|"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You might be wondering whether you can use <code>read_delim()</code> to import <code>.csv</code> files too. The answer is ‘Yes, you can!’. In contrast to <code>read_delim()</code>, <code>read_csv()</code> sets the delimiter to <code>,</code> by default. This is mainly for convenience because <code>.csv</code> files are one of the most popular file formats used to store data.</p>
<p>You might also be wondering what a <em>‘delimiter’</em> is. When you record data in a plain-text file, it is easy to see where a new observation starts and ends because it is defined by a row in your file. However, we also need to tell our software where a new column starts, i.e.&nbsp;where a cell begins and ends. Consider the following example. We have a file that holds our data which looks like this:</p>
<pre><code>idagegender
124male
256female
333male</code></pre>
<p>The first row we probably can still decipher as <code>id</code>, <code>age</code>, <code>gender</code>. However, the next row makes it difficult to understand which value represents the <code>id</code> of a participant and which value reflects the <code>age</code> of that participant. Like us, computer software would find it hard too to decide on this ambiguous content. Thus, we need to use delimiters to make it very clear which value belongs to which column. For example, in a <code>.csv</code> file, the data would be separated by a <code>,</code>.</p>
<pre><code>id,age,gender
1,24,male
2,56,female
3,33,male</code></pre>
<p>Considering our example from above, we could also use <code>|</code> as a delimiter, but this is very unusual.</p>
<pre><code>id|age|gender
1|24|male
2|56|female
3|33|male</code></pre>
<p>An important advantage of this approach is the ability to load large data files much more quickly. The previous options offer a preview of your data, but loading this preview can take a long time for large datasets. Therefore, I highly recommend using the <code>readr</code> functions directly in the console or your R script to avoid frustration when importing large datasets.</p>
<p>There is a lot more to <code>readr</code> than could be covered in this book. If you want to know more about this <em>R</em> package, I highly recommend looking at the <a href="https://readr.tidyverse.org" target="blank" title="package webpage">readr webpage</a>.</p>
</section>
</section>
<section id="sec-inspecting-raw-data" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="sec-inspecting-raw-data"><span class="header-section-number">7.2</span> Inspecting your data</h2>
<p>For the rest of this chapter, we will use the World Value Survery data <span class="citation" data-cites="wvs2022">(<a href="references.html#ref-wvs2022" role="doc-biblioref">Haerpfer et al. 2022</a>)</span> (<code>wvs</code>) from the <code>r4np</code> package. However, we do not know much about this dataset, and therefore we cannot ask any research questions worth investigating. Therefore, we need to look at what it contains. The first method of inspecting a dataset is to type the name of the object, i.e.&nbsp;<code>wvs</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure you loaded the 'r4np' package first</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(r4np)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the data in the console</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>wvs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8,564 × 7
   `Participant ID` `Country name`              Gender   Age relationship_status
              &lt;dbl&gt; &lt;chr&gt;                        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              
 1         68070001 Bolivia, Plurinational Sta…      0    60 married            
 2         68070002 Bolivia, Plurinational Sta…      0    40 married            
 3         68070003 Bolivia, Plurinational Sta…      0    25 single             
 4         68070004 Bolivia, Plurinational Sta…      1    71 widowed            
 5         68070005 Bolivia, Plurinational Sta…      1    38 married            
 6         68070006 Bolivia, Plurinational Sta…      1    20 separated          
 7         68070007 Bolivia, Plurinational Sta…      0    39 single             
 8         68070008 Bolivia, Plurinational Sta…      1    19 single             
 9         68070009 Bolivia, Plurinational Sta…      0    20 single             
10         68070010 Bolivia, Plurinational Sta…      1    37 married            
# ℹ 8,554 more rows
# ℹ 2 more variables: Freedom.of.Choice &lt;dbl&gt;, `Satisfaction-with-life` &lt;dbl&gt;</code></pre>
</div>
</div>
<p>The result is a series of rows and columns. The first information we receive is: <code>A tibble: 69,578 x 7</code>. This indicates that our dataset has 69,578 observations (i.e.&nbsp;rows) and 9 columns (i.e.&nbsp;variables). This rectangular format is the one we encounter most frequently in Social Sciences (and probably beyond). If you ever worked in Microsoft Excel, this format will look familiar. However, rectangular data is not necessarily <code>tidy</code> data. <span class="citation" data-cites="wickham2014tidy">Wickham (<a href="references.html#ref-wickham2014tidy" role="doc-biblioref">2014</a>)</span> (p.&nbsp;4) defines tidy data as follows:</p>
<p><br></p>
<blockquote class="blockquote">
<ol type="1">
<li>Each variable forms a column.</li>
<li>Each observation forms a row.</li>
<li>Each type of observational unit forms a table.</li>
</ol>
</blockquote>
<p><br></p>
<p>Even though it might be nice to look at a tibble in the console, it is not particularly useful. Depending on your monitor size, you might only see a small number of columns, and therefore we do not get to see a complete list of all variables. In short, we hardly ever will find much use in inspecting data this way. Luckily other functions can help us.</p>
<p>If you want to see each variable covered in the dataset and their data types, you can use the function <code>glimpse()</code> from the <code>dplyr</code> package which is loaded as part of the <code>tidyverse</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(wvs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,564
Columns: 7
$ `Participant ID`         &lt;dbl&gt; 68070001, 68070002, 68070003, 68070004, 68070…
$ `Country name`           &lt;chr&gt; "Bolivia, Plurinational State of", "Bolivia, …
$ Gender                   &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, …
$ Age                      &lt;dbl&gt; 60, 40, 25, 71, 38, 20, 39, 19, 20, 37, 42, 7…
$ relationship_status      &lt;chr&gt; "married", "married", "single", "widowed", "m…
$ Freedom.of.Choice        &lt;dbl&gt; 7, 8, 10, 5, 5, 5, 5, 10, 6, 9, 5, 8, 8, 7, 5…
$ `Satisfaction-with-life` &lt;dbl&gt; 5, 7, 8, 5, 7, 3, 3, 8, 7, 8, 9, 6, 7, 7, 4, …</code></pre>
</div>
</div>
<p>The output of glimpse shows us the name of each column/variable after the <code>$</code>, for example, <code>`Participant ID`</code>. The <code>$</code> is used to lookup certain variables in our dataset. For example, if we want to inspect the column <code>relationship_status</code> only, we could write the following:</p>
<div class="cell" data-out.lines="4">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>wvs<span class="sc">$</span>relationship_status</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   [1] "married"                    "married"                   
   [3] "single"                     "widowed"                   
   [5] "married"                    "separated"                 
   [7] "single"                     "single"                    
....</code></pre>
</div>
</div>
<p>When using <code>glimpse()</code> we find the recognised data type for each column, i.e.&nbsp;each variable, in <code>&lt;...&gt;</code>, for example <code>&lt;chr&gt;</code>. We will return to data types in <a href="#sec-change-data-types" class="quarto-xref"><span>Section 7.4</span></a>. Lastly, we get examples of the values included in each variable. This output is much more helpful.</p>
<p>I use <code>glimpse()</code> very frequently for different purposes, for example:</p>
<ul>
<li><p>to understand what variables are included in a dataset,</p></li>
<li><p>to check the correctness of data types,</p></li>
<li><p>to inspect variable names for typos or unconventional names,</p></li>
<li><p>to look up variable names.</p></li>
</ul>
<p>There is one more way to inspect your data and receive more information about it by using a specialised <em>R</em> package. The <code>skimr</code> package is excellent in ‘skimming’ your dataset. It provides not only information about variable names and data types but also provides some descriptive statistics. If you installed the <code>r4np</code> package and called the function <code>install_r4np()</code>, you will have <code>skimr</code> installed already.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(wvs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output in the <em>Console</em> should look like this:</p>
<p><img src="images/chapter_07_img/02_skimr_output/skimr_output.png" class="img-fluid" alt="Screenshot of R output in the console when summarising data using the skimr package."></p>
<p>As you can tell, there is a lot more information in this output. Many descriptive statistics that could be useful are already displayed. <code>skim()</code> provides a summary of the dataset and then automatically sorts the variables by data type. Depending on the data type, you also receive different descriptive statistics. As a bonus, the function also provides a histogram for numeric variables. However, there is one main problem: Some of the numeric variables are not numeric: <code>Participant ID</code> and <code>Gender</code>. Thus, we will have to correct the data types in a moment.</p>
<p>Inspecting your data in this way can be helpful to get a better understanding of what your data includes and spot problems with it. In addition, if you receive data from someone else, these methods are an excellent way to familiarise yourself with the dataset relatively quickly. Since I prepared this particular dataset for this book, I also made sure to provide documentation for it. You can access it by using <code>?wvs</code> in the <em>Console</em>. This will open the documentation in the <em>Help</em> pane. Such documentation is available for every dataset we use in this book.</p>
</section>
<section id="sec-colnames-cleaning" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="sec-colnames-cleaning"><span class="header-section-number">7.3</span> Cleaning your column names: Call the <code>janitor</code></h2>
<p>If you have eagle eyes, you might have noticed that most of the variable names in <code>wvs</code> are not consistent or easy to read/use.</p>
<div class="sourceCode" id="messy_column_names"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="messy_column_names-1"><a href="#messy_column_names-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Whitespace and inconsistent capitalisation</span></span>
<span id="messy_column_names-2"><a href="#messy_column_names-2" aria-hidden="true" tabindex="-1"></a>Participant ID        </span>
<span id="messy_column_names-3"><a href="#messy_column_names-3" aria-hidden="true" tabindex="-1"></a>Country name          </span>
<span id="messy_column_names-4"><a href="#messy_column_names-4" aria-hidden="true" tabindex="-1"></a>Gender                </span>
<span id="messy_column_names-5"><a href="#messy_column_names-5" aria-hidden="true" tabindex="-1"></a>Age                   </span>
<span id="messy_column_names-6"><a href="#messy_column_names-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="messy_column_names-7"><a href="#messy_column_names-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Difficult to read</span></span>
<span id="messy_column_names-8"><a href="#messy_column_names-8" aria-hidden="true" tabindex="-1"></a>Freedom.of.Choice     </span>
<span id="messy_column_names-9"><a href="#messy_column_names-9" aria-hidden="true" tabindex="-1"></a>Satisfaction<span class="sc">-</span>with<span class="sc">-</span>life</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>From <a href="05_r_basics.html#sec-coding-etiquette" class="quarto-xref"><span>Section 5.5</span></a>, you will remember that being consistent in writing your code and naming your objects is essential. The same applies, of course, to variable names. <em>R</em> will not break using the existing names, but it will save you a lot of frustration if we take a minute to clean the names and make them more consistent. Since we will use column names in almost every line of code we produce, it is best to standardise them and make them easier to read and write.</p>
<p>You are probably thinking: “This is easy. I just open the dataset in Excel and change all the column names.” Indeed, it would be a viable and easy option, but it is not very efficient, especially with larger datasets with many more variables. Instead, we can make use of the <code>janitor</code> package. By definition, <code>janitor</code> is a package that helps to clean up whatever needs cleaning. In our case, we want to tidy our column names. We can use the function <code>clean_names()</code> to achieve this. We store the result in a new object called <code>wvs</code> to keep those changes. The object will also show up in our <em>Environment</em> pane.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(wvs)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(wvs_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,564
Columns: 7
$ participant_id         &lt;dbl&gt; 68070001, 68070002, 68070003, 68070004, 6807000…
$ country_name           &lt;chr&gt; "Bolivia, Plurinational State of", "Bolivia, Pl…
$ gender                 &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1,…
$ age                    &lt;dbl&gt; 60, 40, 25, 71, 38, 20, 39, 19, 20, 37, 42, 73,…
$ relationship_status    &lt;chr&gt; "married", "married", "single", "widowed", "mar…
$ freedom_of_choice      &lt;dbl&gt; 7, 8, 10, 5, 5, 5, 5, 10, 6, 9, 5, 8, 8, 7, 5, …
$ satisfaction_with_life &lt;dbl&gt; 5, 7, 8, 5, 7, 3, 3, 8, 7, 8, 9, 6, 7, 7, 4, 8,…</code></pre>
</div>
</div>
<p>Now that <code>janitor</code> has done its magic, we suddenly have easy to read variable names that are consistent with the <em>‘Tidyverse style guide’</em> <span class="citation" data-cites="wickham-2021">(<a href="references.html#ref-wickham-2021" role="doc-biblioref">Wickham 2021</a>)</span>.</p>
<p>If, for whatever reason, the variable names are still not looking the way you want, you can use the function <code>rename()</code> from the <code>dplyr</code> package to manually assign new variable names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="ot">&lt;-</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">satisfaction =</span> satisfaction_with_life,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">country =</span> country_name)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(wvs_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,564
Columns: 7
$ participant_id      &lt;dbl&gt; 68070001, 68070002, 68070003, 68070004, 68070005, …
$ country             &lt;chr&gt; "Bolivia, Plurinational State of", "Bolivia, Pluri…
$ gender              &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1,…
$ age                 &lt;dbl&gt; 60, 40, 25, 71, 38, 20, 39, 19, 20, 37, 42, 73, 32…
$ relationship_status &lt;chr&gt; "married", "married", "single", "widowed", "marrie…
$ freedom_of_choice   &lt;dbl&gt; 7, 8, 10, 5, 5, 5, 5, 10, 6, 9, 5, 8, 8, 7, 5, 10,…
$ satisfaction        &lt;dbl&gt; 5, 7, 8, 5, 7, 3, 3, 8, 7, 8, 9, 6, 7, 7, 4, 8, 5,…</code></pre>
</div>
</div>
<p>You are probably wondering what <code>|&gt;</code> stands for. This symbol is called a <em>‘piping operator’</em> , and it allows us to chain multiple functions together by considering the output of the previous function. So, do not confuse <code>&lt;-</code> with <code>|&gt;</code>. Each operator serves a different purpose. The <code>|&gt;</code> has become synonymous with the <code>tidyverse</code> approach to <em>R</em> programming and is the chosen approach for this book. Many functions from the <code>tidyverse</code> are designed to be chained together.</p>
<p>If we wanted to spell out what we just did, we could say:</p>
<ol type="1">
<li><p><code>wvs &lt;-</code>: We assigned whatever happened to the right of the assignment operator to the object <code>wvs</code>.</p></li>
<li><p><code>wvs |&gt;</code>: We defined the dataset we want to use with the functions defined after the <code>|&gt;</code>.</p></li>
<li><p><code>rename(satisfaction = satisfcation_with_life)</code>: We define a new name <code>satisfaction</code> for the column <code>satisfaction_with_life</code>. Notice that the order is <code>new_name = old_name</code>. Here we also use <code>=</code>. A rare occasion where it makes sense to do so.</p></li>
</ol>
<p>Just for clarification, the following two lines of code accomplish the same task. The only difference is that with <code>|&gt;</code> we could chain another function right after it. So, you could say, it is a matter of taste which approach you prefer. However, in later chapters, it will become apparent why using <code>|&gt;</code> is very advantageous.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Renaming a column using '|&gt;'</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">satisfaction_new =</span> satisfaction)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Renaming a column without '|&gt;'</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(wvs_clean, <span class="at">satisfaction_new =</span> satisfaction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since you will be using the pipe operator very frequently, it is a good idea to remember the keyboard shortcut for it: <code>Ctrl+Shift+M</code> for PC and <code>Cmd+Shift+M</code> for Mac.</p>
<p>Besides <code>|&gt;</code> operator you might also find that some sources use a different pipe operator <code>%&gt;%</code>. The original <code>tidyverse</code> approach used <code>%&gt;%</code> before R introduced their own pipe operator. In short: You can use both of them if you like, but in 90% of cases, you probably will be fine using the one that comes shipped with RStudio by default, i.e.&nbsp;<code>|&gt;</code>. More and more R resources adopt the <code>|&gt;</code> operator and there are only few situations where <code>%&gt;%</code> is preferred. For the content of this book and the techniques demonstrated here, you can use both operators interchangeably and the code will work just fine.</p>
</section>
<section id="sec-change-data-types" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="sec-change-data-types"><span class="header-section-number">7.4</span> Data types: What are they and how can you change them</h2>
<p>When we inspected our data, I mentioned that some variables do not have the correct data type. You might be familiar with different data types by classifying them as:</p>
<ul>
<li><p><em>Nominal data</em>, which is categorical data of no particular order,</p></li>
<li><p><em>Ordinal data</em>, which is categorical data with a defined order, and</p></li>
<li><p><em>Quantitative data</em>, which is data that usually is represented by numeric values.</p></li>
</ul>
<p>In <em>R</em> we have a slightly different distinction:</p>
<ul>
<li><p><code>character</code> / <code>&lt;chr&gt;</code>: Textual data, for example the text of a tweet.</p></li>
<li><p><code>factor</code> / <code>&lt;fct&gt;</code>: Categorical data with a finite number of categories with no particular order.</p></li>
<li><p><code>ordered</code> / <code>&lt;ord&gt;</code>: Categorical data with a finite number of categories with a particular order.</p></li>
<li><p><code>double</code> / <code>&lt;dbl&gt;</code>: Numerical data with decimal places.</p></li>
<li><p><code>integer</code> / <code>&lt;int&gt;</code>: Numerical data with whole numbers only (i.e.&nbsp;no decimals).</p></li>
<li><p><code>logical</code> / <code>&lt;lgl&gt;</code>: Logical data, which only consists of values <code>TRUE</code> and <code>FALSE</code>.</p></li>
<li><p><code>date</code> / <code>date</code>: Data which consists of dates, e.g.&nbsp;<code>2021-08-05</code>.</p></li>
<li><p><code>date-time</code> / <code>dttm</code>: Data which consists of dates and times, e.g.&nbsp;<code>2021-08-05 16:29:25 BST</code>.</p></li>
</ul>
<p>For a complete list of data types, I recommend looking at <a href="https://tibble.tidyverse.org/articles/types.html" target="blank" title="'Column Data Types'">‘Column Data Types’</a> <span class="citation" data-cites="data-types-2021">(<a href="references.html#ref-data-types-2021" role="doc-biblioref">Müller and Wickham 2021</a>)</span>.</p>
<p>R has a fine-grained categorisation of data types. The most important distinction, though, lies between <code>&lt;chr&gt;</code>, <code>&lt;fct&gt;</code>/<code>&lt;ord&gt;</code> and <code>&lt;dbl&gt;</code> for most datasets in the Social Sciences. Still, it is good to know what the abbreviations in your <code>tibble</code> mean and how they might affect your analysis.</p>
<p>Now that we have a solid understanding of different data types, we can look at our dataset and see whether <code>readr</code> classified our variables correctly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(wvs_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,564
Columns: 7
$ participant_id      &lt;dbl&gt; 68070001, 68070002, 68070003, 68070004, 68070005, …
$ country             &lt;chr&gt; "Bolivia, Plurinational State of", "Bolivia, Pluri…
$ gender              &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1,…
$ age                 &lt;dbl&gt; 60, 40, 25, 71, 38, 20, 39, 19, 20, 37, 42, 73, 32…
$ relationship_status &lt;chr&gt; "married", "married", "single", "widowed", "marrie…
$ freedom_of_choice   &lt;dbl&gt; 7, 8, 10, 5, 5, 5, 5, 10, 6, 9, 5, 8, 8, 7, 5, 10,…
$ satisfaction        &lt;dbl&gt; 5, 7, 8, 5, 7, 3, 3, 8, 7, 8, 9, 6, 7, 7, 4, 8, 5,…</code></pre>
</div>
</div>
<p><code>readr</code> did a great job in identifying all the numeric variables. However, by default, <code>readr</code> imports all variables that include text as <code>&lt;chr&gt;</code>. It appears as if this is not entirely correct for our dataset. The variables <code>country</code>, <code>gender</code> and <code>relationship_status</code> specify a finite number of categories. Therefore they should be classified as a <code>factor</code>. The variable <code>participant_id</code> is represented by numbers, but its meaning is also rather categorical. We would not use the ID numbers of participants to perform additions or multiplications. This would make no sense. Therefore, it might be wise to turn them into a <code>factor</code>, even though we likely will not use it in our analysis and would make no difference. However, I am a stickler for those kinds of things.</p>
<p>To perform the conversion, we need to use two new functions from <code>dplyr</code>:</p>
<ul>
<li><p><code>mutate()</code>: Changes, i.e.&nbsp;‘mutates’, a variable.</p></li>
<li><p><code>as_factor()</code>: Converts data from one type into a <code>factor</code>.</p></li>
</ul>
<p>If we want to convert all variables in one go, we can put them into the same function, separated by a <code>,</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="ot">&lt;-</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">as_factor</span>(country),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">gender =</span> <span class="fu">as_factor</span>(gender),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">relationship_status =</span> <span class="fu">as_factor</span>(relationship_status),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">participant_id =</span> <span class="fu">as_factor</span>(participant_id)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(wvs_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,564
Columns: 7
$ participant_id      &lt;fct&gt; 68070001, 68070002, 68070003, 68070004, 68070005, …
$ country             &lt;fct&gt; "Bolivia, Plurinational State of", "Bolivia, Pluri…
$ gender              &lt;fct&gt; 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1,…
$ age                 &lt;dbl&gt; 60, 40, 25, 71, 38, 20, 39, 19, 20, 37, 42, 73, 32…
$ relationship_status &lt;fct&gt; married, married, single, widowed, married, separa…
$ freedom_of_choice   &lt;dbl&gt; 7, 8, 10, 5, 5, 5, 5, 10, 6, 9, 5, 8, 8, 7, 5, 10,…
$ satisfaction        &lt;dbl&gt; 5, 7, 8, 5, 7, 3, 3, 8, 7, 8, 9, 6, 7, 7, 4, 8, 5,…</code></pre>
</div>
</div>
<p>The output in the console shows that we successfully performed the transformation and our data types are as we intended them to be. Mission accomplished.</p>
<p>If you need to convert all <code>&lt;chr&gt;</code> columns you can use <code>mutate_if(is.character, as_factor)</code> instead. This function will look at each column and if it is a <code>character</code> type variable, it will convert it into a <code>factor</code>. However, use this function only if you are certain that all <code>character</code> columns need converting. If this is the case, it can be a huge time-saver. Here is the corresponding code snippet:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, as_factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lastly, there might be occasions where you want to convert data into other formats than from <code>&lt;chr&gt;</code> to <code>&lt;fct&gt;</code>. Similar to <code>as_factor()</code> there are more functions available to transform your data into the correct format of your choice:</p>
<ul>
<li><p><code>as.integer()</code>: Converts values into integers, i.e.&nbsp;without decimal places. Be aware that this function does not round values as you might expect. Instead, it removes any decimals as if they never existed.</p></li>
<li><p><code>as.numeric()</code>: Converts values into numbers with decimals if they are present.</p></li>
<li><p><code>as.character()</code>: Converts values to string values, even if they are numbers. If you use <code>readr</code> to import your data, you will not often use this function because <code>readr</code> imports unknown data types as <code>&lt;chr&gt;</code> by default.</p></li>
</ul>
<p>All these function can be used in the same as we did before. Here are three examples to illustrated their use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conversion to character values</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>converted_data <span class="ot">&lt;-</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">participant_id =</span> <span class="fu">as.character</span>(participant_id),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">age =</span> <span class="fu">as.character</span>(age))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(converted_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,564
Columns: 7
$ participant_id      &lt;chr&gt; "68070001", "68070002", "68070003", "68070004", "6…
$ country             &lt;fct&gt; "Bolivia, Plurinational State of", "Bolivia, Pluri…
$ gender              &lt;fct&gt; 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1,…
$ age                 &lt;chr&gt; "60", "40", "25", "71", "38", "20", "39", "19", "2…
$ relationship_status &lt;fct&gt; married, married, single, widowed, married, separa…
$ freedom_of_choice   &lt;dbl&gt; 7, 8, 10, 5, 5, 5, 5, 10, 6, 9, 5, 8, 8, 7, 5, 10,…
$ satisfaction        &lt;dbl&gt; 5, 7, 8, 5, 7, 3, 3, 8, 7, 8, 9, 6, 7, 7, 4, 8, 5,…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conversion to numeric values</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>converted_data <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">as.numeric</span>(age))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8,564 × 7
   participant_id country     gender   age relationship_status freedom_of_choice
   &lt;chr&gt;          &lt;fct&gt;       &lt;fct&gt;  &lt;dbl&gt; &lt;fct&gt;                           &lt;dbl&gt;
 1 68070001       Bolivia, P… 0         60 married                             7
 2 68070002       Bolivia, P… 0         40 married                             8
 3 68070003       Bolivia, P… 0         25 single                             10
 4 68070004       Bolivia, P… 1         71 widowed                             5
 5 68070005       Bolivia, P… 1         38 married                             5
 6 68070006       Bolivia, P… 1         20 separated                           5
 7 68070007       Bolivia, P… 0         39 single                              5
 8 68070008       Bolivia, P… 1         19 single                             10
 9 68070009       Bolivia, P… 0         20 single                              6
10 68070010       Bolivia, P… 1         37 married                             9
# ℹ 8,554 more rows
# ℹ 1 more variable: satisfaction &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert numeric values to integers</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>numeric_values <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">1.3</span>, <span class="fl">2.6</span>, <span class="fl">3.8</span>))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>numeric_values <span class="sc">|&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">integers =</span> <span class="fu">as.integer</span>(values))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  values integers
   &lt;dbl&gt;    &lt;int&gt;
1    1.3        1
2    2.6        2
3    3.8        3</code></pre>
</div>
</div>
</section>
<section id="sec-handling-factors" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="sec-handling-factors"><span class="header-section-number">7.5</span> Handling factors</h2>
<p>Factors are an essential way to classify observations in our data in different ways. In terms of data wrangling, there are usually at least three steps we take to prepare them for analysis:</p>
<ul>
<li>Recoding factors,</li>
<li>Reordering factor levels, and</li>
<li>Removing factor levels</li>
</ul>
<section id="sec-recoding-factors" class="level3" data-number="7.5.1">
<h3 data-number="7.5.1" class="anchored" data-anchor-id="sec-recoding-factors"><span class="header-section-number">7.5.1</span> Recoding factors</h3>
<p>Another common problem we have to tackle when working with data is their representation in the dataset. For example, <code>gender</code> could be measured as <code>male</code> and <code>female</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> or as <code>0</code> and <code>1</code>. <em>R</em> does not mind which way you represent your data, but some other software does. Therefore, when we import data from somewhere else, the values of a variable might not look the way we want. The practicality of having your data represented accurately as what they are, becomes apparent when you intend to create tables and plots.</p>
<p>For example, we might be interested in knowing how many participants in <code>wvs_clean</code> were <code>male</code> and <code>female</code>. The function <code>count()</code> from <code>dplyr</code> does precisely that. We can sort the results, i.e.&nbsp;<code>n</code>, in descending order by including <code>sort = TRUE</code>. By default, <code>count()</code> arranges our variable <code>gender</code> in alphabetical order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span> <span class="fu">count</span>(gender, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  gender     n
  &lt;fct&gt;  &lt;int&gt;
1 1       4348
2 0       4216</code></pre>
</div>
</div>
<p>Now we know how many people were <code>male</code> and <code>female</code> and how many did not disclose their <code>gender</code>. Or do we? The issue here is that you would have to know what <code>0</code> and <code>1</code> stand for. Surely you would have a coding manual that gives you the answer, but it seems a bit of a complication. For <code>gender</code>, this might still be easy to remember, but can you recall the ID numbers for 48 countries?</p>
<p>It certainly would be easier to replace the <code>0</code>s and <code>1</code>s with their corresponding labels. This can be achieved with a simple function called <code>fct_recode()</code> from <code>forcats</code>. However, since we ‘mutate’ a variable into something else, we also have to use the <code>mutate()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="ot">&lt;-</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">fct_recode</span>(gender,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"male"</span> <span class="ot">=</span> <span class="st">"0"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"female"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you have been following along very carefully, you might spot one oddity in this code: <code>"0"</code> and <code>"1"</code>. You likely recall that in <a href="05_r_basics.html" class="quarto-xref"><span>Chapter 5</span></a>, I mentioned that we use <code>""</code> for <code>character</code> values but not for numbers. So what happens if we run the code and remove <code>""</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">fct_recode</span>(gender,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"male"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"female"</span> <span class="ot">=</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `mutate()`:
ℹ In argument: `gender = fct_recode(gender, male = 0, female = 1)`.
Caused by error in `fct_recode()`:
! Each element of `...` must be a named string.
ℹ Problems with 2 arguments: male and female</code></pre>
</div>
</div>
<p>The error message is easy to understand: <code>fct_recode()</code> only expects <code>strings</code> as input and not numbers. R recognises <code>0</code> and <code>1</code> as numbers, but <code>fct_recode()</code> only converts a <code>factor</code> value into another <code>factor</code> value and since we ‘mutated’ gender from a <code>numeric</code> variable to a <code>factor</code> variable, all values of gender are no longer numbers. To refer to a factor level (i.e.&nbsp;one of the categories in our factor), we have to use <code>""</code>. In other words, data types matter and are often a source of problems with your code. Thus, always pay close attention to them. For now, it is important to remember that factor levels are always string values, i.e.&nbsp;text.</p>
<p>Now that we have change the factor levels to our liking, we can rerun our analysis and generate a frequency table for <code>gender</code>. This time we receive a much more readable output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span> <span class="fu">count</span>(gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  gender     n
  &lt;fct&gt;  &lt;int&gt;
1 male    4216
2 female  4348</code></pre>
</div>
</div>
<p>Another benefit of going through the trouble of recoding your factors is the readability of your plots. For example, we could quickly generate a bar plot based on the above table and have appropriate labels instead of <code>0</code> and <code>1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gender) <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(gender, n)) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gender-bar-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-gender-bar-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07_data_wrangling_files/figure-html/fig-gender-bar-plot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gender-bar-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.1: A bar plot of the factor levels <code>male</code> and <code>female</code>
</figcaption>
</figure>
</div>
</div>
</div>
<p>Plots are an excellent way to explore your data and understand relationships between variables. We will learn more about this when we start to perform analytical steps on our data (see <a href="08_descriptive_statistics.html" class="quarto-xref"><span>Chapter 8</span></a> and beyond).</p>
<p>Another use case for recoding factors could be for purely cosmetic reasons. For example, when looking through our dataset, we might notice that some country names are very long and do not look great in data visualisations or tables. Thus, we could consider shortening them which is a slightly more advanced process.</p>
<p>First, we need to find out which country names are particularly long. There are 48 countries in this dataset, so it could take some time to look through them all. Instead, we could use the function <code>filter()</code> from <code>dplyr</code> to pick only countries with a long name. However, this poses another problem: How can we tell the filter function to pick only country names with a certain length? Ideally, we would want a function that does the counting for us. As you probably anticipated, there is a package called <code>stringr</code>, which also belongs to the <code>tidyverse,</code> and has a function that counts the number of characters that represent a value in our dataset: <code>str_length()</code>. This function takes any <code>character</code> variable and returns the length of it. This also works with <code>factors</code> because this function can ‘coerce’ it into a <code>character</code>, i.e.&nbsp;it just ignores that it is a <code>factor</code> and looks at it as if it was a regular <code>character</code> variable. Good news for us, because now we can put the puzzle pieces together.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_length</span>(country) <span class="sc">&gt;=</span> <span class="dv">15</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  country                             n
  &lt;fct&gt;                           &lt;int&gt;
1 Bolivia, Plurinational State of  2067
2 Iran, Islamic Republic of        1499
3 Korea, Republic of               1245</code></pre>
</div>
</div>
<p>I use the value <code>15</code> arbitrarily after some trial and error. You can change the value and see which other countries would show up with a lower threshold. However, this number seems to do the trick and returns three countries that seem to have longer names. All we have to do is replace these categories with new ones the same way we recoded <code>gender</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="ot">&lt;-</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">fct_recode</span>(country,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Bolivia"</span> <span class="ot">=</span> <span class="st">"Bolivia, Plurinational State of"</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Iran"</span> <span class="ot">=</span> <span class="st">"Iran, Islamic Republic of"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Korea"</span> <span class="ot">=</span> <span class="st">"Korea, Republic of"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have country names that nicely fit into tables and plots we want to create later and do not have to worry about it later.</p>
</section>
<section id="sec-reordering-factor-levels" class="level3" data-number="7.5.2">
<h3 data-number="7.5.2" class="anchored" data-anchor-id="sec-reordering-factor-levels"><span class="header-section-number">7.5.2</span> Reordering factor levels</h3>
<p>Besides changing factor levels, it is also common that we want to reconsider the arrangement of these levels. To inspect the order of factor levels, we can use the function <code>fct_unique()</code> from the <code>forcats</code> package and provide a factor variable, e.g.&nbsp;<code>gender</code>, in the <code>wvs_clean</code> dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_unique</span>(wvs_clean<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] male   female
Levels: male female</code></pre>
</div>
</div>
<p>A reason for changing the order of factor levels could be to arrange how factor levels are displayed in plots. For example, <a href="#fig-gender-bar-plot" class="quarto-xref">Figure&nbsp;<span>7.1</span></a> shows the bar of <code>male</code> participants first, but instead, we might want to show <code>female</code> participants first. The <code>forcats</code> package offers several options to rearrange factor levels based on different conditions. Depending on the circumstances, one or the other function might be more efficient. Four of <a href="https://forcats.tidyverse.org/reference/index.html" target="blank" title="forcats functions to change order of factor levels">these functions</a> I tend to use fairly frequently:</p>
<ul>
<li><p><code>fct_relevel()</code>: To reorder factor levels by hand.</p></li>
<li><p><code>fct_reorder()</code>: To reorder factor levels based on another variable of interest.</p></li>
<li><p><code>fct_rev()</code>: To reverse the order of factor levels.</p></li>
<li><p><code>fct_infreq()</code>: To reorder factor levels by frequency of appearance in our dataset.</p></li>
</ul>
<p>Each function requires slightly different arguments. If we wanted to change the order of our factor levels, we could use all four of them to achieve the same result (in our case):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder by hand</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gender) <span class="sc">|&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_relevel</span>(gender, <span class="st">"female"</span>, <span class="st">"male"</span>),</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_data_wrangling_files/figure-html/reorder-factor-levels-forcats-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder by another variable, e.g. the frequency 'n'</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gender) <span class="sc">|&gt;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(gender, n, <span class="at">.desc =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_data_wrangling_files/figure-html/reorder-by-other-variable-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The function <code>fct_infreq()</code> is particularly convenient when looking at frequencies, because it will automatically order factor levels according to their size. Thus, we can skip the part where we <code>count()</code> factor levels and use <code>geom_bar()</code> instead.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder based on frequency of appearance</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_infreq</span>(gender))) <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_data_wrangling_files/figure-html/reorder-by-other-variable-infreq-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reverse the order of factor levels</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gender) <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_rev</span>(gender),</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_data_wrangling_files/figure-html/reverse-order-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There are many ways to rearrange factors, and it very much depends on the data you have and what you wish to achieve. For most of my plots, I tend to revert to a basic R function, i.e.&nbsp;<code>reorder()</code>, which is much shorter to type and does essentially the same as <code>fct_reorder()</code>. There is no right or wrong in this regard, just personal taste.</p>
</section>
<section id="sec-removing-factor-levels" class="level3" data-number="7.5.3">
<h3 data-number="7.5.3" class="anchored" data-anchor-id="sec-removing-factor-levels"><span class="header-section-number">7.5.3</span> Removing factor levels</h3>
<p>When we work with factors, it can sometimes happen that we have factor levels that are not linked to any of our observations in the dataset, but when we try to perform certain analytical steps they might get in the way (for example in <a href="13_regressions.html#sec-regressions-with-control-variables" class="quarto-xref"><span>Section 13.3.1</span></a>). Therefore it is important to perform some housekeeping and remove unneeded factor levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A dataset which contains a factor with 4 levels</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">gender =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"female"</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"male"</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"non-binary"</span>),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                               </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># Setting the factor levels</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"female"</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"male"</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"non-binary"</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"unknown"</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>                               )</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 1
  gender    
  &lt;fct&gt;     
1 female    
2 male      
3 non-binary</code></pre>
</div>
</div>
<p>The <code>data</code> dataframe contains the variable <code>gender</code> which has four levels, but only three levels are represented in the data, i.e.&nbsp;the factor level <code>unknown</code> matches none of our observations in the dataset. However, it is still there:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All four factors are still here</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(data<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "female"     "male"       "non-binary" "unknown"   </code></pre>
</div>
</div>
<p>If we want to remove the unused factor level we have two options: We can either use <code>droplevels()</code> or <code>fct_drop()</code> from the <code>forcats</code> package. A nice little perk of the <code>droplevels()</code> function is that it can remove unused factor levels from all factors in the dataset. Here are the different options in action:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1: Using 'droplevels()</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>data_3_lvls <span class="ot">&lt;-</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">droplevels</span>(gender))</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(data_3_lvls<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "female"     "male"       "non-binary"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2: Using 'fct_drop()</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>data_3_lvls <span class="ot">&lt;-</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">fct_drop</span>(gender))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(data_3_lvls<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "female"     "male"       "non-binary"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing unused factor levels of all factors </span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>data_3_levels <span class="ot">&lt;-</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> <span class="fu">droplevels</span>()</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(data_3_lvls<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "female"     "male"       "non-binary"</code></pre>
</div>
</div>
<p>In my experience, it is always good to remove unused categories (i.e.&nbsp;levels) because sometimes they can lead to unexpected outcomes. Thus, it is a matter of good practice than an absolute necessity. Besides, it is fairly easy to tidy your factors with the above functions.</p>
</section>
</section>
<section id="sec-handling-dates-times-and-durations" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="sec-handling-dates-times-and-durations"><span class="header-section-number">7.6</span> Handling dates, times and durations</h2>
<p>There are many reasons why we encounter dates, times and durations in our research. The most apparent reason for handling dates and times is longitudinal studies that focus on change over time. Therefore, at least one of our variables would have to carry a timestamp. When it comes to data cleaning and wrangling, there are usually two tasks we need to perform:</p>
<ul>
<li><p>Convert data into a suitable format for further analysis, and</p></li>
<li><p>Perform computations with dates and times, e.g.&nbsp;computing the duration between two time points.</p></li>
</ul>
<p>The following sections will provide some guidance on solving commonly occurring issues and how to solve them.</p>
<section id="sec-converting-dates-and-times-for-analysis" class="level3" data-number="7.6.1">
<h3 data-number="7.6.1" class="anchored" data-anchor-id="sec-converting-dates-and-times-for-analysis"><span class="header-section-number">7.6.1</span> Converting dates and times for analysis</h3>
<p>No matter which data collection tool you use, you likely encounter differences in how various software report dates and times back to you. Not only is there a great variety in formats in which dates and times are reported, but there are also other issues that one has to take care of, e.g.&nbsp;time zone differences. Here are some examples of how dates could be reported in your data:</p>
<pre><code>26 November 2022
26 Nov 2022
November, 26 2022
Nov, 26 2022
26/11/2022
11/26/2022
2022-11-26
20221126</code></pre>
<p>It would be nice if there was a standardised method of recording dates and times and, in fact, there is one: <a href="https://www.iso.org/iso-8601-date-and-time-format.html" title="ISO 8601: A standard for reporting and recording dates and times">ISO 8601</a>. But unfortunately, not every software, let alone scholar, necessarily adheres to this standard. Luckily there is a dedicated <em>R</em> package that solely deals with these issues called <code>lubridate</code>, which is also part of the <code>tidyverse</code>. It helps reformat data into a coherent format and takes care of other essential aspects, such as ‘<em>time zones, leap days, daylight savings times, and other time related quirks</em>’ <span class="citation" data-cites="lubridate">(<a href="references.html#ref-lubridate" role="doc-biblioref">Grolemund and Wickham 2011</a>)</span>. Here, we will primarily focus on the most common issues, but I highly recommend looking at the <a href="https://lubridate.tidyverse.org/" target="_blank" title="Website of the package 'lubridate'">‘lubridate’ website</a> to see what else the package has to offer.</p>
<p>Let’s consider the dates (i.e.&nbsp;the data type <code>date</code>) shown above and try to convert them all into the same format. To achieve this we can use three different functions, i.e.&nbsp;<code>dmy()</code>, <code>mdy()</code> and <code>ymd()</code>. It is probably very obvious what these letters stand for:</p>
<ul>
<li><p><code>d</code> for day,</p></li>
<li><p><code>m</code> for month, and</p></li>
<li><p><code>y</code> for year.</p></li>
</ul>
<p>All we have to do is identify the order in which the dates are presented in your dataset, and the <code>lubridate</code> package will do its magic to standardise the format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># All of the below will yield the same output</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy</span>(<span class="st">"26 November 2022"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-11-26"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy</span>(<span class="st">"26 Nov 2022"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-11-26"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">"November, 26 2022"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-11-26"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">"Nov, 26 2022"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-11-26"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy</span>(<span class="st">"26/11/2022"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-11-26"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">"11/26/2022"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-11-26"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">"2022-11-26"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-11-26"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">"20221126"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-11-26"</code></pre>
</div>
</div>
<p>Besides dates, we sometimes also have to deal with times. For example, when did someone start a survey and finish it. If you frequently work with software like Qualtrics, SurveyMonkey, etc., you are often provided with such information. From a diagnostic perspective, understanding how long it took someone to complete a questionnaire can provide valuable insights into survey optimisation and design or show whether certain participants properly engaged with your data collection tool. In <em>R</em>, we can use either <code>time</code> or <code>dttm</code> (date-time) as a data type to capture hours, minutes and seconds. The <code>lubridate</code> package handles <code>time</code> similarly to <code>date</code> with easily recognisable abbreviations:</p>
<ul>
<li><p><code>h</code> for hour,</p></li>
<li><p><code>m</code> for minutes, and</p></li>
<li><p><code>s</code> for seconds.</p></li>
</ul>
<p>Here is a simple example that demonstrates how conveniently <code>lubridate</code> manages to handle even the most outrages ways of specifying times:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>dinner_time <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="st">"17:34:21"</span>,</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"17:::34:21"</span>,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"17 34 21"</span>,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"17 : 34 : 21"</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>dinner_time <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">time_new =</span> <span class="fu">hms</span>(time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  time         time_new   
  &lt;chr&gt;        &lt;Period&gt;   
1 17:34:21     17H 34M 21S
2 17:::34:21   17H 34M 21S
3 17 34 21     17H 34M 21S
4 17 : 34 : 21 17H 34M 21S</code></pre>
</div>
</div>
<p>Lastly, <code>dttm</code> data types combine both: <code>date</code> and <code>time</code>. To illustrate how we can work with this format we can look at some actual data from a questionnaire. For example, the <code>`quest_time`</code> dataset has information about questionnaire completion dates and times..</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>quest_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 84 × 3
      id start            end             
   &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;           
 1     1 12/05/2016 20:46 12/05/2016 20:49
 2     2 19/05/2016 22:08 19/05/2016 22:25
 3     3 20/05/2016 07:05 20/05/2016 07:14
 4     4 13/05/2016 08:59 13/05/2016 09:05
 5     5 13/05/2016 11:25 13/05/2016 11:29
 6     6 13/05/2016 11:31 13/05/2016 11:37
 7     7 20/05/2016 11:29 20/05/2016 11:45
 8     8 20/05/2016 14:07 20/05/2016 14:21
 9     9 20/05/2016 14:55 20/05/2016 15:01
10    10 20/05/2016 16:12 20/05/2016 16:25
# ℹ 74 more rows</code></pre>
</div>
</div>
<p>While it all looks neat and tidy, keeping dates and times as a <code>chr</code> is not ideal, especially if we want to use it to conduct further analysis. Therefore, it would be important to transform these variables into the appropriate <code>dttm</code> format. We can use the function <code>dmy_hm()</code> similar to previous functions we used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>quest_time_clean <span class="ot">&lt;-</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  quest_time <span class="sc">|&gt;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">start =</span> <span class="fu">dmy_hm</span>(start),</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">end =</span> <span class="fu">dmy_hm</span>(end)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>quest_time_clean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 84 × 3
      id start               end                
   &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;             
 1     1 2016-05-12 20:46:00 2016-05-12 20:49:00
 2     2 2016-05-19 22:08:00 2016-05-19 22:25:00
 3     3 2016-05-20 07:05:00 2016-05-20 07:14:00
 4     4 2016-05-13 08:59:00 2016-05-13 09:05:00
 5     5 2016-05-13 11:25:00 2016-05-13 11:29:00
 6     6 2016-05-13 11:31:00 2016-05-13 11:37:00
 7     7 2016-05-20 11:29:00 2016-05-20 11:45:00
 8     8 2016-05-20 14:07:00 2016-05-20 14:21:00
 9     9 2016-05-20 14:55:00 2016-05-20 15:01:00
10    10 2016-05-20 16:12:00 2016-05-20 16:25:00
# ℹ 74 more rows</code></pre>
</div>
</div>
<p>While the difference between this format and the previous one is relatively marginal and unimpressive, the main benefit of this conversation becomes apparent when we perform operations on these variables, e.g.&nbsp;computing the time it took participants to complete the questionnaire.</p>
</section>
<section id="sec-computation-dates-times" class="level3" data-number="7.6.2">
<h3 data-number="7.6.2" class="anchored" data-anchor-id="sec-computation-dates-times"><span class="header-section-number">7.6.2</span> Computing durations with dates, times and date-time variables</h3>
<p>Once we have ‘corrected’ our variables to show as dates, times and date-times, we can perform further analysis and ask important questions about durations, periods and intervals of observations.</p>
<p>Let’s consider the <code>quest_time</code> dataset which we just prepared. As mentioned earlier, it is often essential to understand how long it took participants to complete a given questionnaire. Therefore we would want to compute the duration based on the <code>start</code> and <code>end</code> time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>df_duration <span class="ot">&lt;-</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  quest_time_clean <span class="sc">|&gt;</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">duration =</span> end <span class="sc">-</span> start)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>df_duration</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 84 × 4
      id start               end                 duration
   &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;              &lt;drtn&gt;  
 1     1 2016-05-12 20:46:00 2016-05-12 20:49:00  3 mins 
 2     2 2016-05-19 22:08:00 2016-05-19 22:25:00 17 mins 
 3     3 2016-05-20 07:05:00 2016-05-20 07:14:00  9 mins 
 4     4 2016-05-13 08:59:00 2016-05-13 09:05:00  6 mins 
 5     5 2016-05-13 11:25:00 2016-05-13 11:29:00  4 mins 
 6     6 2016-05-13 11:31:00 2016-05-13 11:37:00  6 mins 
 7     7 2016-05-20 11:29:00 2016-05-20 11:45:00 16 mins 
 8     8 2016-05-20 14:07:00 2016-05-20 14:21:00 14 mins 
 9     9 2016-05-20 14:55:00 2016-05-20 15:01:00  6 mins 
10    10 2016-05-20 16:12:00 2016-05-20 16:25:00 13 mins 
# ℹ 74 more rows</code></pre>
</div>
</div>
<p>From these results, it seems that some participants have either super-humanly fast reading skills or did not engage with the questionnaire. To get a better overview, we can plot <code>duration</code> to see the distribution better.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>df_duration <span class="sc">|&gt;</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(duration),</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_data_wrangling_files/figure-html/duration-boxplot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For now, you should not worry about what this code means but rather consider the interpretation of the plot, i.e.&nbsp;that most participants (represented by a black dot) needed less than 20 minutes to complete the questionnaire. Depending on the length of your data collection tool, this could either be good or bad news. Usually, the shorter the questionnaire can be, the higher the response rate, unless you have incentives for participants to complete a longer survey.</p>
<p>In <a href="08_descriptive_statistics.html" class="quarto-xref"><span>Chapter 8</span></a>, we will cover data visualisations like this boxplot in greater detail. If you cannot wait any longer and want to create your own visualisations, you are welcome to skip ahead. However, several data visualisations are awaiting you in the next chapter as well.</p>
</section>
</section>
<section id="sec-dealing-with-missing-data" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="sec-dealing-with-missing-data"><span class="header-section-number">7.7</span> Dealing with missing data</h2>
<p>There is hardly any Social Sciences project where researchers do not have to deal with missing data. Participants are sometimes unwilling to complete a questionnaire or miss the second round of data collection entirely, e.g.&nbsp;in longitudinal studies. It is not the purpose of this chapter to delve into all aspects of analysing missing data but provide a solid starting point. There are mainly three steps involved in dealing with missing data:</p>
<ol type="1">
<li><p>Mapping missing data,</p></li>
<li><p>Identifying patterns of missing data, and</p></li>
<li><p>Replacing or removing missing data</p></li>
</ol>
<section id="sec-mapping-missing-data" class="level3" data-number="7.7.1">
<h3 data-number="7.7.1" class="anchored" data-anchor-id="sec-mapping-missing-data"><span class="header-section-number">7.7.1</span> Mapping missing data</h3>
<p>Every study that intends to be rigorous will have to identify how much data is missing because it affects the interpretability of our available data. In <em>R</em>, this can be achieved in multiple ways, but using a specialised package like <code>naniar</code> does help us to do this very quickly and systematically. First, we have to load the <code>naniar</code> package, and then we use the function <code>vis_miss()</code> to visualise how much and where exactly data is missing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(wvs_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-mapping-missing-data" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mapping-missing-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07_data_wrangling_files/figure-html/fig-mapping-missing-data-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mapping-missing-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.2: Mapping missing data with <code>naniar</code>
</figcaption>
</figure>
</div>
</div>
</div>
<p><code>naniar</code> plays along nicely with the <code>tidyverse</code> approach of programming. As such, it would also be possible to write <code>wvs |&gt; vis_miss()</code>.</p>
<p>As we can see, 99,7% of our dataset is complete, and we are only missing 0.3%. The dark lines (actually blocks) refer to missing data points. On the x-axis, we can see all our variables, and on the y-axis, we see our observations. This is the same layout as our rectangular dataset: Rows are observations, and columns are variables. Overall, this dataset appears relatively complete (luckily). In addition, we can see the percentage of missing data per variable. <code>freedom_of_choice</code> is the variable with the most missing data, i.e.&nbsp;0.79%. Still, the amount of missing data is not very large.</p>
<p>When working with larger datasets, it might also be helpful to rank variables by their degree of missing data to see where the most significant problems lie.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_var</span>(wvs_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-missing-data-per-variable" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-missing-data-per-variable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07_data_wrangling_files/figure-html/fig-missing-data-per-variable-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-missing-data-per-variable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.3: Missing data per variable
</figcaption>
</figure>
</div>
</div>
</div>
<p>As we already know from the previous data visualisation, <code>freedom_of_choice</code> has the most missing data points, while <code>participant_id</code>, and <code>country_name</code> have no missing values. If you prefer to see the actual numbers instead, we can use a series of functions that start with <code>miss_</code> (for a complete list of all functions, see the <a href="https://naniar.njtierney.com/reference/index.html" target="blank" title="reference page of naniar">reference page of naniar</a>). For example, to retrieve the numeric values which are reflected in the plot above, we can write the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise the missingness in each variable</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_var_summary</span>(wvs_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  variable            n_miss pct_miss
  &lt;chr&gt;                &lt;int&gt;    &lt;num&gt;
1 freedom_of_choice      117    1.37 
2 satisfaction            36    0.420
3 relationship_status     19    0.222
4 participant_id           0    0    
5 country                  0    0    
6 gender                   0    0    
7 age                      0    0    </code></pre>
</div>
</div>
<p>I tend to prefer data visualisations over numerical results for mapping missing data, especially in larger datasets with many variables. This also has the benefit that patterns of missing data can be more easily identified as well.</p>
</section>
<section id="sec-patterns-of-missing-data" class="level3" data-number="7.7.2">
<h3 data-number="7.7.2" class="anchored" data-anchor-id="sec-patterns-of-missing-data"><span class="header-section-number">7.7.2</span> Identifying patterns of missing data</h3>
<p>If you find that your data ‘suffers’ from missing data, it is essential to answer another question: Is data missing systematically? This is quite an important diagnostic step since systematically missing data would imply that if we remove these observations from our dataset, we likely produce wrong results. The following section elaborate on this aspect of missing data. In general, we can distinguish missing data based on how it is missing, i.e.</p>
<ul>
<li><p>missing completely at random (MCAR),</p></li>
<li><p>missing at random (MAR), and</p></li>
<li><p>missing not at random (MNAR). <span class="citation" data-cites="rubin-1976">(<a href="references.html#ref-rubin-1976" role="doc-biblioref">Rubin 1976</a>)</span></p></li>
</ul>
<section id="sec-missing-completetly-at-random-mcar" class="level4" data-number="7.7.2.1">
<h4 data-number="7.7.2.1" class="anchored" data-anchor-id="sec-missing-completetly-at-random-mcar"><span class="header-section-number">7.7.2.1</span> Missing completely at random (MCAR)</h4>
<p>Missing completely at random (MCAR) means that neither observed nor missing data can systematically explain why data is missing. It is a pure coincidence how data is missing, and there is no underlying pattern.</p>
<p>The <code>naniar</code> package comes with the very popular Little’s MCAR test <span class="citation" data-cites="little-1988">(<a href="references.html#ref-little-1988" role="doc-biblioref">Little 1988</a>)</span>, which provides insights into whether our data is missing completely at random. Thus, we can call the function <code>mcar_test()</code> and inspect the result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove variables which do not reflect a response</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>participant_id) <span class="sc">|&gt;</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcar_test</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  statistic    df  p.value missing.patterns
      &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;            &lt;int&gt;
1      113.    26 7.66e-13                7</code></pre>
</div>
</div>
<p>When you run such a test, you have to ensure that variables that are not part of the data collection process are removed. In our case, the <code>participant_id</code> is generated by the researcher and does not represent an actual response by the participants. As such, we need to remove it using <code>select()</code> before we can run the test. A <code>-</code> inverts the meaning of <code>select()</code>. While <code>select(participant_id)</code> would do what it says, i.e.&nbsp;include it as the only variable in the test, <code>select(-participant_id)</code> results in selecting everything but this variable in our test. You will find it is sometimes easier to remove a variable with <code>select()</code> rather than listing all the variables you want to keep.</p>
<p>Since the <code>p.value</code> of the test is so small that it got rounded down to <code>0</code>, i.e.&nbsp;<span class="math inline">\(p&lt;0.0001\)</span>, we have to assume that our data is not missing completely at random. If we found that <span class="math inline">\(p&gt;0.05\)</span>, we would have confirmation that data are missing completely at random. We will cover p-values and significance tests in more detail in <a href="10_correlations.html#sec-significance" class="quarto-xref"><span>Section 10.3</span></a>.</p>
</section>
<section id="sec-missing-at-random-mar" class="level4" data-number="7.7.2.2">
<h4 data-number="7.7.2.2" class="anchored" data-anchor-id="sec-missing-at-random-mar"><span class="header-section-number">7.7.2.2</span> Missing at random (MAR)</h4>
<p>Missing at random (MAR) refers to a situation where the observed data can explain missing data, but not any unobserved data. <span class="citation" data-cites="dong-et-al-2013">Dong and Peng (<a href="references.html#ref-dong-et-al-2013" role="doc-biblioref">2013</a>)</span> (p.&nbsp;2) provide a good example when this is the case:</p>
<blockquote class="blockquote">
<p><em>Let’s suppose that students who scored low on the pre-test are more likely to drop out of the course, hence, their scores on the post-test are missing. If we assume that the probability of missing the post-test depends only on scores on the pre-test, then the missing mechanism on the post-test is MAR. In other words, for students who have the same pre-test score, the probability of (them) missing the post-test is random.</em></p>
</blockquote>
<p>Thus, the main difference between MCAR and MAR data lies in the fact that we can observe some patterns of missing data if data is MAR. These patterns are only based on data we have, i.e.&nbsp;observed data. We also assume that no unobserved variables can explain these or other patterns.</p>
<p>Accordingly, we first look into variables with no missing data and see whether they can explain our missing data in other variables. For example, we could investigate whether missing data in <code>freedom_of_choice</code> is attributed to specific countries. <a id="missing-data-by-country-table"></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">|&gt;</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(freedom_of_choice)) <span class="sc">|&gt;</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
# Groups:   country [4]
  country     n
  &lt;fct&gt;   &lt;int&gt;
1 Japan      47
2 Bolivia    40
3 Egypt      23
4 Iran        7</code></pre>
</div>
</div>
<p>It seems four countries have exceptionally high numbers of missing data for <code>freedom_of_choice</code>: Japan, Brazil, New Zealand, Russia and Bolivia. Why this is the case lies beyond this dataset and is something only the researchers themselves could explain. Collecting data in different countries is particularly challenging, and one is quickly faced with different unfavourable conditions. Furthermore, the missing data is not completely random because we have some first evidence that the location of data collection might have affected its completeness.</p>
<p>Another way of understanding patterns of missing data can be achieved by looking at relationships between missing values, for example, the co-occurrence of missing values across different variables. This can be achieved by using <em>upset plots</em>. An <em>upset plot</em> consists of three parts: Set size, intersection size and a Venn diagram which defines the intersections.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_upset</span>(wvs_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_data_wrangling_files/figure-html/upset-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The most frequent combination of missing data in our dataset occurs when only <code>freedom_of_choice</code> is missing (the first column), but nothing else. Similar results can be found for <code>relationships_status</code> and <code>age</code>. The first combination of missing data is defined by two variables: <code>satisfaction</code> and <code>freedom_of_choice</code>. In total, 107 participants had <code>satisfaction</code> and <code>freedom_of_choice</code> missing but nothing else.</p>
<p>The ‘set size’ shown in the upset plot refers to the number of missing values for each variable in the diagram. This corresponds to what we have found when looking at <a href="#fig-missing-data-per-variable" class="quarto-xref">Figure&nbsp;<span>7.3</span></a>.</p>
<p>Our analysis also suggests that values are not completely randomly missing but that we have data to help explain why they are missing.</p>
</section>
<section id="sec-missing-not-at-random-mnar" class="level4" data-number="7.7.2.3">
<h4 data-number="7.7.2.3" class="anchored" data-anchor-id="sec-missing-not-at-random-mnar"><span class="header-section-number">7.7.2.3</span> Missing not at random (MNAR)</h4>
<p>Lastly, missing not at random (MNAR) implies that data is missing systematically and that other variables or reasons exist that explain why data is missing. Still, they are not fully known to us. In questionnaire-based research, an easily overlooked reason that can explain missing data is the ‘page-drop-off’ phenomenon. In such cases, participants stop completing a questionnaire once they advance to another page. <a href="#fig-mnar-example" class="quarto-xref">Figure&nbsp;<span>7.4</span></a> shows this very clearly for a large scale project where an online questionnaire was used. After almost every page break in the questionnaire, some participants decided to discontinue. Finding these types of patterns is difficult when only working with numeric values. Thus, it is always advisable to visualise your data as well. Such missing data is linked to the design of the data collection tool.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-mnar-example" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mnar-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/chapter_07_img/03_missing_data/00_mnar_example.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mnar-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.4: MNAR pattern in a dataset due to ‘page-drop-offs’
</figcaption>
</figure>
</div>
</div>
</div>
<p>Defining whether a dataset is MNAR or not is mainly achieved by ruling out MCAR and MAR assumptions. It is not possible to test whether missing data is MNAR, unless we have more information about the underlying population available <span class="citation" data-cites="van2020rebutting">(<a href="references.html#ref-van2020rebutting" role="doc-biblioref">Ginkel et al. 2020</a>)</span>.</p>
<p>We have sufficient evidence that our data is MAR as was shown <a href="#missing-at-random-mar">above</a>, because we managed to identify some relationships between unobserved and observed data. In practice, it is very rare to find datasets that are truly MCAR <span class="citation" data-cites="van-buuren-2018">(<a href="references.html#ref-van-buuren-2018" role="doc-biblioref">Buuren 2018</a>)</span>. Therefore we might consider ‘imputation’ as a possible strategy to solve our missing data problem. More about imputation in the next Chapter.</p>
<p>If you are looking for more inspiration of how you could visualise and identify patterns of missingness in your data, you might find the ‘<a href="https://naniar.njtierney.com/articles/naniar-visualisation.html" target="blank" title="Gallery of 'naniar' plots">Gallery</a>’ of the <code>naniar</code> website particularly useful.</p>
</section>
</section>
<section id="sec-replacing-removing-missing-data" class="level3" data-number="7.7.3">
<h3 data-number="7.7.3" class="anchored" data-anchor-id="sec-replacing-removing-missing-data"><span class="header-section-number">7.7.3</span> Replacing or removing missing data</h3>
<p>Once you determined which pattern of missing data applies to your dataset, it is time to evaluate how we want to deal with those missing values. Generally, you can either keep the missing values as they are, replace them or remove them entirely.</p>
<p><span class="citation" data-cites="jakobsen-et-al-2017">Jakobsen et al. (<a href="references.html#ref-jakobsen-et-al-2017" role="doc-biblioref">2017</a>)</span> provide a rule of thumb of 5% where researchers can consider missing data as negligible, i.e.&nbsp;we can ignore the missing values because they won’t affect our analysis in a significant way. They also argue that if the proportion of missing data exceeds 40%, we should also only work with our observed data. However, with such a large amount of missing data, it is questionable whether we can rely on our analysis as much as we want to. If the missing data lies somewhere in-between this range, we need to consider the missing data pattern at hand.</p>
<p>If data is MCAR, we could remove missing data. This process is called <em>‘listwise deletion’</em>, i.e.&nbsp;you remove all data from a participant with missing data. As just mentioned, removing missing values is only suitable if you have relatively few missing values in your dataset <span class="citation" data-cites="schafer-1999">(<a href="references.html#ref-schafer-1999" role="doc-biblioref">Schafer 1999</a>)</span>, as is the case with the <code>wvs</code> dataset. There are additional problems with deleting observations listwise, many of which are summarised by <span class="citation" data-cites="van-buuren-2018">Buuren (<a href="references.html#ref-van-buuren-2018" role="doc-biblioref">2018</a>)</span> in his <a href="https://stefvanbuuren.name/fimd/sec-simplesolutions.html" target="blank" title="introduction">introduction</a>. Usually, we try to avoid removing data as much as possible. If you wanted to perform listwise deletion, it can be done with a single function call: <code>na.omit()</code> from the built-in <code>stats</code> package. Alternatively, you could also use <code>drop_na()</code> from the <code>tidyr</code> package, which is automatically loaded when used <code>library(tidyverse)</code>. Here is an example of how we can apply these two functions to achieve the same effect.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># No more missing data in this plot</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span> <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> <span class="fu">vis_miss</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_data_wrangling_files/figure-html/remove-all-missing-data-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here is the alternative method with drop_na()</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span> <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> <span class="fu">vis_miss</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_data_wrangling_files/figure-html/alternative-of-removing-all-missing-data-points-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many observations are left after we removed all missing data?</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>wvs_clean <span class="sc">|&gt;</span> <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1  8418</code></pre>
</div>
</div>
<p>If you wanted to remove the missing data without the plot, you could use <code>wvs_no_na &lt;- na.omit(wvs)</code> or <code>wvs_no_na &lt;- drop_na()</code>. However, I always recommend ‘saving’ the result in a new object to ensure we keep the original data available. This can be helpful when trying to compare how this decision affects my analysis, i.e.&nbsp;I can run the analysis with and without missing data removed. For the <code>wvs</code> dataset, using <code>na.omit()</code> does not seem to be the best option.</p>
<p>Based on our analysis of the <code>wvs</code> dataset (by no means complete!), we could assume that data is MAR. In such cases, it is possible to ‘impute’ the missing values, i.e.&nbsp;replacing the missing data with computed scores. This is possible because we can model the missing data based on variables we have. We cannot model missing data based on variables we have not measured in our study for obvious reasons.</p>
<p>You might be thinking: “Why would it make data better if we ‘make up’ numbers? Is this not cheating?” Imputation of missing values is a science in itself. There is plenty to read about the process of handling missing data, which would reach far beyond the scope of this book. However, the seminal work of <span class="citation" data-cites="van-buuren-2018">Buuren (<a href="references.html#ref-van-buuren-2018" role="doc-biblioref">2018</a>)</span>, <span class="citation" data-cites="dong-et-al-2013">Dong and Peng (<a href="references.html#ref-dong-et-al-2013" role="doc-biblioref">2013</a>)</span> and <span class="citation" data-cites="jakobsen-et-al-2017">Jakobsen et al. (<a href="references.html#ref-jakobsen-et-al-2017" role="doc-biblioref">2017</a>)</span> are excellent starting points. In short: Simply removing missing data can lead to biases in your data, e.g.&nbsp;if we removed missing data in our dataset, we would mainly exclude participants from Japan, Brazil, New Zealand, Russia and Bolivia (as we found out <a href="#missing-data-by-country-table">earlier</a>). While imputation is not perfect, it can produce more reliable results than not using imputation at all, assuming our data meets the requirements for such imputation.</p>
<p>Even though our dataset has only a minimal amount of missing data (relative to the entire size), we can still use imputation. There are many different ways to approach this task, one of which is ‘multiple imputation’. As highlighted by <span class="citation" data-cites="van2020rebutting">Ginkel et al. (<a href="references.html#ref-van2020rebutting" role="doc-biblioref">2020</a>)</span>, multiple imputation has not yet reached the same popularity as listwise deletion, despite its benefits. The main reason for this lies in the complexity of using this technique. There are many more approaches to imputation, and going through them all in detail would be impossible and distract from the book’s main purpose. Still, I would like to share some interesting packages with you that use different imputation methods:</p>
<ul>
<li><p><a href="https://cran.r-project.org/web/packages/Amelia/index.html" target="blank" title="mice">mice</a> (Uses multivariate imputation via chained equations)</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/Amelia/index.html" target="blank" title="Amelia">Amelia</a> (Uses a bootstrapped-based algorithm)</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/missForest/index.html" target="blank" title="missForest">missForest</a> (Uses a random forest algorithm)</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/Hmisc/index.html" target="blank" title="Hmisc">Hmisc</a> (Uses additive regression, bootstrapping, and predictive mean matching)</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/mi/index.html" target="blank" title="mi">mi</a> (Uses posterior predictive distribution, predictive mean matching, mean-imputation, median-imputation, or conditional mean-imputation)</p></li>
</ul>
<p>Besides multiple imputation, there is also the option for single imputation. The <code>simputation</code> package offers a great variety of imputation functions, one of which also fits our data quite well <code>impute_knn()</code>. This function makes use of a clustering technique called <em>‘K-nearest neighbour’</em>. In this case, the function will look for observations closest to the one with missing data and take the value of that observation. In other words, it looks for participants who answered the questionnaire in a very similar way. The great convenience of this approach is that it can handle all kinds of data types simultaneously, which is not true for all imputation techniques.</p>
<p>If we apply this function to our dataset, we have to write the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>wvs_nona <span class="ot">&lt;-</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  wvs_clean <span class="sc">|&gt;</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>participant_id) <span class="sc">|&gt;</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transform our tibble into a data frame</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>  simputation<span class="sc">::</span><span class="fu">impute_knn</span>(. <span class="sc">~</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Be aware that our new dataframe has different datatypes</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(wvs_nona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,564
Columns: 6
$ country             &lt;fct&gt; Bolivia, Bolivia, Bolivia, Bolivia, Bolivia, Boliv…
$ gender              &lt;fct&gt; male, male, male, female, female, female, male, fe…
$ age                 &lt;dbl&gt; 60, 40, 25, 71, 38, 20, 39, 19, 20, 37, 42, 73, 32…
$ relationship_status &lt;fct&gt; married, married, single, widowed, married, separa…
$ freedom_of_choice   &lt;chr&gt; "7", "8", "10", "5", "5", "5", "5", "10", "6", "9"…
$ satisfaction        &lt;chr&gt; "5", "7", "8", "5", "7", "3", "3", "8", "7", "8", …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's fix this</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>wvs_nona <span class="ot">&lt;-</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  wvs_nona <span class="sc">|&gt;</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">as.numeric</span>(age),</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">freedom_of_choice =</span> <span class="fu">as.numeric</span>(freedom_of_choice),</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">satisfaction =</span> <span class="fu">as.numeric</span>(satisfaction))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function <code>impute_knn(. ~ .)</code> might look like a combination of text with an emoji <code>(. ~ .)</code>. This imputation function requires us to specify a model to impute the data. Since we want to impute all missing values in the dataset and use all variables available, we put <code>.</code> on both sides of the equation, separated by a <code>~</code>. The <code>.</code> reflects that we do not specify a specific variable but instead tell the function to use all variables that are not mentioned. In our case, we did not mention any variables at all, and therefore it chooses all of them. For example, if we wanted to impute only <code>freedom_of_choice</code>, we would have to put <code>impute_knn(freedom_of_choice ~ .)</code>. We will elaborate more on how to specify models when we cover regression models (see <a href="13_regressions.html" class="quarto-xref"><span>Chapter 13</span></a>).</p>
<p>As you will have noticed, we also had to convert our <code>tibble</code> into a <code>data frame</code> using <code>as.data.frame()</code>. As mentioned in <a href="05_r_basics.html#sec-functions" class="quarto-xref"><span>Section 5.3</span></a>, some functions require a specific data type or format. The <code>simputation</code> package works with <code>dplyr</code>, but it prefers <code>data frame</code>s. Based on my experiences, the wrong data type or format is one of the most frequent causes of errors that novice <em>R</em> programmers report. So, keep an eye on it and read the documentation carefully. Also, once you inspect the new data frame, you will notice that some of our <code>double</code> variables have now turned into <code>character</code> values. Therefore, I strongly recommend checking your newly created data frames to avoid any surprises further down the line of your analysis. <em>R</em> requires us to be very precise in our work, which I think is rather an advantage than an annoyance<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<p>Be aware that imputation of any kind can take a long time. For example, my MacBook Pro took about 4.22 seconds to complete <code>impute_knn()</code> with the <code>wvs</code> dataset. If we used multiple imputation, this would have taken considerably longer, i.e.&nbsp;several minutes and more.</p>
<p>We now should have a dataset that is free of any missing values. To ensure this is the case we can create the missing data matrix that we made at the beginning of this chapter (see <a href="#fig-mapping-missing-data" class="quarto-xref">Figure&nbsp;<span>7.2</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(wvs_nona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-mapping-missing-data-imputed-data" class="quarto-figure quarto-figure-center quarto-float anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mapping-missing-data-imputed-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07_data_wrangling_files/figure-html/fig-mapping-missing-data-imputed-data-1.png" id="fig-mapping-missing-data-imputed-data" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-mapping-missing-data-imputed-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.5
</figcaption>
</figure>
</div>
</div>
</div>
<p>As the plot demonstrates, we managed to obtain a dataset which is now free of missing values and we can perform our next steps of data wrangling or analysis.</p>
</section>
<section id="sec-two-more-methods-of-replacing-missing-data" class="level3" data-number="7.7.4">
<h3 data-number="7.7.4" class="anchored" data-anchor-id="sec-two-more-methods-of-replacing-missing-data"><span class="header-section-number">7.7.4</span> Two more methods of replacing missing data you hardly ever need</h3>
<p>There are two more options for replacing missing data<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>, but these I would hardly ever recommend. Still, this section would not be complete without mentioning them, and they have their use-cases.</p>
<p>The first method involves the function <code>replace_na()</code>. It allows you to replace any missing data with a value of your choice. For example, let’s consider the following dataset which contains feedback from students regarding one of their lectures.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The dataset which contains the feedback</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>student_feedback <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Thomas"</span>, <span class="cn">NA</span>, <span class="st">"Helen"</span>, <span class="cn">NA</span>),</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">feedback =</span> <span class="fu">as.numeric</span>(<span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">5</span>, <span class="cn">NA</span>, <span class="dv">4</span>)),</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">overall =</span> <span class="fu">as_factor</span>(<span class="fu">c</span>(<span class="st">"excellent"</span>, <span class="st">"very good"</span>, <span class="cn">NA</span>, <span class="cn">NA</span>))</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>student_feedback</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  name   feedback overall  
  &lt;chr&gt;     &lt;dbl&gt; &lt;fct&gt;    
1 Thomas        6 excellent
2 &lt;NA&gt;          5 very good
3 Helen        NA &lt;NA&gt;     
4 &lt;NA&gt;          4 &lt;NA&gt;     </code></pre>
</div>
</div>
<p>We have different types of data to deal with in <code>student_feedback</code>, and there are several missing data points, i.e.&nbsp;<code>NA</code> in each column. We can use the <code>replace_na()</code> function to decide how to replace the missing data. For <code>feedback</code>, we might want to insert a number, for example, the average of all available ratings (<code>(6 + 5+ 4) / 3 = 5)</code>. However, we might wish to add some string values for <code>name</code> and <code>overall</code>. We have to keep in mind that <code>replace_na()</code> requires a <code>chr</code> variable as input, which is not the case for <code>overall</code>, because it is a <code>factor</code>. Consequently, we need to go back to <a href="#sec-change-data-types" class="quarto-xref"><span>Section 7.4</span></a> and change the data type before replacing <code>NA</code>s. Here is how we can achieve all this in a few lines of code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>student_feedback <span class="sc">|&gt;</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">replace_na</span>(name, <span class="st">"Unkown"</span>),</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">feedback =</span> <span class="fu">replace_na</span>(feedback, <span class="dv">5</span>),</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">overall =</span> <span class="fu">replace_na</span>(<span class="fu">as.character</span>(overall), <span class="st">"unrated"</span>),</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">overall =</span> <span class="fu">as_factor</span>(overall)</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  name   feedback overall  
  &lt;chr&gt;     &lt;dbl&gt; &lt;fct&gt;    
1 Thomas        6 excellent
2 Unkown        5 very good
3 Helen         5 unrated  
4 Unkown        4 unrated  </code></pre>
</div>
</div>
<p>We successfully replaced all the missing values with values of our choice. Only for <code>overall</code> we have to perform two steps. If you feel adventurous, you could also warp the <code>as_factor()</code> function around the <code>replace_na()</code> one. This would result in using only one line of code for this variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>student_feedback <span class="sc">|&gt;</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">replace_na</span>(name, <span class="st">"Unkown"</span>),</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">feedback =</span> <span class="fu">replace_na</span>(feedback, <span class="dv">0</span>),</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">overall =</span> <span class="fu">as_factor</span>(<span class="fu">replace_na</span>(<span class="fu">as.character</span>(overall), <span class="st">"unrated"</span>))</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  name   feedback overall  
  &lt;chr&gt;     &lt;dbl&gt; &lt;fct&gt;    
1 Thomas        6 excellent
2 Unkown        5 very good
3 Helen         0 unrated  
4 Unkown        4 unrated  </code></pre>
</div>
</div>
<p>This approach to handling missing data can be beneficial when addressing these values explicitly, e.g.&nbsp;in a plot. While one could keep the label of <code>NA</code>, it sometimes makes sense to use a different label that is more meaningful to your intended audience. Still, I would abstain from replacing <code>NA</code>s with an arbitrary value unless there is a good reason for it.</p>
<p>The second method of replacing missing values is less arbitrary and requires the function <code>fill()</code>. It replaces missing values with the previous or next non-missing value. The <a href="https://tidyr.tidyverse.org/reference/fill.html" target="_blank" title="Help page for the function 'fill()'">official help page</a> for this function offers some excellent examples of when one would need it, i.e.&nbsp;when specific values are only recorded once for a set of data points. For example, we might want to know how many students are taking certain lectures, but the module ID is only recorded for the first student on each module.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The dataset which contains student enrollment numbers</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>student_enrollment <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">module =</span> <span class="fu">c</span>(<span class="st">"Management"</span>, <span class="cn">NA</span>, <span class="cn">NA</span>,</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="cn">NA</span>, <span class="st">"Marketing"</span>, <span class="cn">NA</span>),</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Alberto"</span>, <span class="st">"Frances"</span>, <span class="st">"Martin"</span>,</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Alex"</span>, <span class="st">"Yuhui"</span>, <span class="st">"Himari"</span>)</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>student_enrollment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  module     name   
  &lt;chr&gt;      &lt;chr&gt;  
1 Management Alberto
2 &lt;NA&gt;       Frances
3 &lt;NA&gt;       Martin 
4 &lt;NA&gt;       Alex   
5 Marketing  Yuhui  
6 &lt;NA&gt;       Himari </code></pre>
</div>
</div>
<p>Here it is unnecessary to guess which values we have to insert because we know that <code>Alberto</code>, <code>Frances</code>, <code>Martin</code>, and <code>Alex</code> are taking the <code>Management</code> lecture. At the same time, <code>Yuhui</code> and <code>Himari</code> opted for Marketing. The <code>fill()</code> function can help us complete the missing values accordingly. By default, it completes values top-down, i.e.&nbsp;it takes the last value that was not missing and copies it down until we reach a non-missing value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>student_enrollment <span class="sc">|&gt;</span> <span class="fu">fill</span>(module)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  module     name   
  &lt;chr&gt;      &lt;chr&gt;  
1 Management Alberto
2 Management Frances
3 Management Martin 
4 Management Alex   
5 Marketing  Yuhui  
6 Marketing  Himari </code></pre>
</div>
</div>
<p>If you have to reverse the direction of how&nbsp;<em>R</em>&nbsp;should fill in the blank cells in your dataset, you can use <code>fill(.direction = "up")</code>. In our example, this would make not much sense, but for the sake of demonstration, here is what would happen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>student_enrollment <span class="sc">|&gt;</span> <span class="fu">fill</span>(module, <span class="at">.direction =</span> <span class="st">"up"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  module     name   
  &lt;chr&gt;      &lt;chr&gt;  
1 Management Alberto
2 Marketing  Frances
3 Marketing  Martin 
4 Marketing  Alex   
5 Marketing  Yuhui  
6 &lt;NA&gt;       Himari </code></pre>
</div>
</div>
<p>This method can be helpful if the system you use to collect or produce your data is only recording changes in values, i.e.&nbsp;it does not record all values for all observations in your dataset.</p>
</section>
<section id="sec-main-takeaways-missing-data" class="level3" data-number="7.7.5">
<h3 data-number="7.7.5" class="anchored" data-anchor-id="sec-main-takeaways-missing-data"><span class="header-section-number">7.7.5</span> Main takeaways regarding dealing with missing data</h3>
<p>Handling missing data is hardly ever a simple process. Do not feel discouraged if you get lost in the myriad of options. While there is some guidance on how and when to use specific strategies to deal with missing values in your dataset, the most crucial point to remember is: Be transparent about what you did. As long as you can explain why you did something and how you did it, everyone can follow your thought process and help improve your analysis. However, ignoring the fact that data is missing and not acknowledging it is more than just unwise.</p>
</section>
</section>
<section id="sec-latent-constructs" class="level2" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="sec-latent-constructs"><span class="header-section-number">7.8</span> Latent constructs and their reliability</h2>
<p>Social Scientists commonly face the challenge that we want to measure something that cannot be measured directly. For example, <em>‘happiness’</em> is a feeling that does not naturally occur as a number we can observe and measure. The opposite is true for <em>‘temperature’</em> which is naturally measured in numbers. At the same time, <em>‘happiness’</em> is much more complex of a variable than <em>‘temperature’</em>, because <em>‘happiness’</em> can unfold in various ways and be caused by different triggers (e.g.&nbsp;a joke, an unexpected present, tasty food, etc.). To account for this, we often work with <em>‘latent variables’</em>. These are defined as variables that are not directly measured but are inferred from other variables. In practice, we often use multiple questions in a questionnaire to measure one latent variable, usually by computing the mean of those questions.</p>
<section id="sec-computing-latent-variables" class="level3" data-number="7.8.1">
<h3 data-number="7.8.1" class="anchored" data-anchor-id="sec-computing-latent-variables"><span class="header-section-number">7.8.1</span> Computing latent variables</h3>
<p>The <code>gep</code> dataset from the <code>r4np</code> package includes data about students’ social integration experience (<code>si</code>) and communication skills development (<code>cs</code>). Data were obtained using the <a href="https://warwick.ac.uk/gep" target="blank" title="Global Education Profiler (GEP)">Global Education Profiler (GEP)</a>. I extracted three different questions (also called <em>‘items’</em>) from the questionnaire, which measure <code>si</code>, and three items that measure <code>cs</code>. This dataset only consists of a randomly chosen set of responses, i.e.&nbsp;300 out of over 12,000.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(gep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 300
Columns: 12
$ age                           &lt;dbl&gt; 22, 26, 21, 23, 25, 27, 24, 23, 21, 24, …
$ gender                        &lt;chr&gt; "Female", "Female", "Female", "Female", …
$ level_of_study                &lt;chr&gt; "UG", "PGT", "UG", "UG", "PGT", "PGT", "…
$ si_socialise_with_people_exp  &lt;dbl&gt; 6, 3, 4, 3, 4, 2, 5, 1, 6, 6, 3, 3, 4, 5…
$ si_supportive_friends_exp     &lt;dbl&gt; 4, 4, 5, 4, 4, 2, 5, 1, 6, 6, 3, 3, 4, 6…
$ si_time_socialising_exp       &lt;dbl&gt; 5, 2, 4, 4, 3, 2, 6, 3, 6, 6, 3, 2, 4, 6…
$ cs_explain_ideas_imp          &lt;dbl&gt; 6, 5, 5, 5, 5, 5, 4, 5, 6, 6, 5, 5, 4, 6…
$ cs_find_clarification_imp     &lt;dbl&gt; 4, 5, 5, 6, 6, 5, 4, 6, 6, 6, 5, 5, 4, 5…
$ cs_learn_different_styles_imp &lt;dbl&gt; 6, 5, 6, 4, 4, 4, 4, 6, 6, 6, 4, 5, 5, 5…
$ cs_explain_ideas_exp          &lt;dbl&gt; 6, 5, 2, 5, 6, 5, 6, 6, 6, 6, 4, 4, 3, 6…
$ cs_find_clarification_exp     &lt;dbl&gt; 6, 5, 4, 6, 6, 5, 6, 6, 6, 6, 2, 5, 4, 5…
$ cs_learn_different_styles_exp &lt;dbl&gt; 6, 4, 5, 4, 6, 3, 5, 6, 6, 6, 2, 4, 2, 5…</code></pre>
</div>
</div>
<p>For example, if we wanted to know how each student scored with regards to social integration (<code>si</code>), we have to</p>
<ul>
<li><p>compute the mean (<code>mean())</code> of all related items (i.e.&nbsp;all variables starting with <code>si_</code>),</p></li>
<li><p>for each row (<code>rowwise()</code>) because each row presents one participant.</p></li>
</ul>
<p>The same is true for communication skills (<code>cs_imp</code> and <code>cs_exp</code>). We can compute all three variables in one go. For each variable, we compute <code>mean()</code> and use <code>c()</code> to list all the variables that we want to include in the mean:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the scores for the latent variable 'si' and 'cs'</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>gep <span class="ot">&lt;-</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  gep <span class="sc">|&gt;</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">si =</span> <span class="fu">mean</span>(<span class="fu">c</span>(si_socialise_with_people_exp,</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>                     si_supportive_friends_exp,</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>                     si_time_socialising_exp</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>                   ),</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">cs_imp =</span> <span class="fu">mean</span>(<span class="fu">c</span>(cs_explain_ideas_imp,</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>                         cs_find_clarification_imp,</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>                         cs_learn_different_styles_imp</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>                       ),</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">cs_exp =</span> <span class="fu">mean</span>(<span class="fu">c</span>(cs_explain_ideas_exp,</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>                         cs_find_clarification_exp,</span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>                         cs_learn_different_styles_exp</span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(gep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 300
Columns: 15
Rowwise: 
$ age                           &lt;dbl&gt; 22, 26, 21, 23, 25, 27, 24, 23, 21, 24, …
$ gender                        &lt;chr&gt; "Female", "Female", "Female", "Female", …
$ level_of_study                &lt;chr&gt; "UG", "PGT", "UG", "UG", "PGT", "PGT", "…
$ si_socialise_with_people_exp  &lt;dbl&gt; 6, 3, 4, 3, 4, 2, 5, 1, 6, 6, 3, 3, 4, 5…
$ si_supportive_friends_exp     &lt;dbl&gt; 4, 4, 5, 4, 4, 2, 5, 1, 6, 6, 3, 3, 4, 6…
$ si_time_socialising_exp       &lt;dbl&gt; 5, 2, 4, 4, 3, 2, 6, 3, 6, 6, 3, 2, 4, 6…
$ cs_explain_ideas_imp          &lt;dbl&gt; 6, 5, 5, 5, 5, 5, 4, 5, 6, 6, 5, 5, 4, 6…
$ cs_find_clarification_imp     &lt;dbl&gt; 4, 5, 5, 6, 6, 5, 4, 6, 6, 6, 5, 5, 4, 5…
$ cs_learn_different_styles_imp &lt;dbl&gt; 6, 5, 6, 4, 4, 4, 4, 6, 6, 6, 4, 5, 5, 5…
$ cs_explain_ideas_exp          &lt;dbl&gt; 6, 5, 2, 5, 6, 5, 6, 6, 6, 6, 4, 4, 3, 6…
$ cs_find_clarification_exp     &lt;dbl&gt; 6, 5, 4, 6, 6, 5, 6, 6, 6, 6, 2, 5, 4, 5…
$ cs_learn_different_styles_exp &lt;dbl&gt; 6, 4, 5, 4, 6, 3, 5, 6, 6, 6, 2, 4, 2, 5…
$ si                            &lt;dbl&gt; 5.000000, 3.000000, 4.333333, 3.666667, …
$ cs_imp                        &lt;dbl&gt; 5.333333, 5.000000, 5.333333, 5.000000, …
$ cs_exp                        &lt;dbl&gt; 6.000000, 4.666667, 3.666667, 5.000000, …</code></pre>
</div>
</div>
<p>Compared to dealing with missing data, this is a fairly straightforward task. However, there is a caveat. Before we can compute the mean across all these variables, we need to know and understand whether all these scores reliably contribute to one single latent variable. If not, we would be in trouble and make a significant mistake. This is commonly known as <em>internal consistency</em> and is a measure of reliability, i.e.&nbsp;how much we can rely on the fact that multiple questions in a questionnaire measure the same underlying, i.e.&nbsp;latent, construct.</p>
</section>
<section id="sec-internal-consistency" class="level3" data-number="7.8.2">
<h3 data-number="7.8.2" class="anchored" data-anchor-id="sec-internal-consistency"><span class="header-section-number">7.8.2</span> Checking internal consistency of items measuring a latent variable</h3>
<p>By far, the most common approach to assessing <em>internal consistency</em> of latent variables is Cronbach’s <span class="math inline">\(\alpha\)</span>. This indicator looks at how strongly a set of items (i.e.&nbsp;questions in your questionnaire) are related to each other. For example, the stronger the relationship of all items starting with <code>si_</code> to each other, the more likely we achieve a higher Cronbach’s <span class="math inline">\(\alpha\)</span>. The <code>psych</code> package has a suitable function to compute it for us.</p>
<p>Instead of listing all the items by hand, I use the function <code>starts_with()</code> to pick only the variables whose names start with <code>si_</code>. It certainly pays off to think about your variable names more thoroughly in advance to benefit from such shortcuts (see also <a href="#sec-colnames-cleaning" class="quarto-xref"><span>Section 7.3</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>gep <span class="sc">|&gt;</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"si_"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  psych<span class="sc">::</span><span class="fu">alpha</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Reliability analysis   
Call: psych::alpha(x = select(gep, starts_with("si_")))

  raw_alpha std.alpha G6(smc) average_r S/N   ase mean  sd median_r
      0.85      0.85     0.8      0.66 5.8 0.015  3.5 1.3     0.65

    95% confidence boundaries 
         lower alpha upper
Feldt     0.82  0.85  0.88
Duhachek  0.82  0.85  0.88

 Reliability if an item is dropped:
                             raw_alpha std.alpha G6(smc) average_r S/N alpha se
si_socialise_with_people_exp      0.82      0.82    0.70      0.70 4.6    0.021
si_supportive_friends_exp         0.77      0.77    0.63      0.63 3.4    0.027
si_time_socialising_exp           0.79      0.79    0.65      0.65 3.7    0.025
                             var.r med.r
si_socialise_with_people_exp    NA  0.70
si_supportive_friends_exp       NA  0.63
si_time_socialising_exp         NA  0.65

 Item statistics 
                               n raw.r std.r r.cor r.drop mean  sd
si_socialise_with_people_exp 300  0.86  0.86  0.75   0.69  3.7 1.4
si_supportive_friends_exp    300  0.90  0.89  0.81   0.75  3.5 1.6
si_time_socialising_exp      300  0.88  0.88  0.79   0.73  3.2 1.5

Non missing response frequency for each item
                                1    2    3    4    5    6 miss
si_socialise_with_people_exp 0.06 0.17 0.22 0.24 0.19 0.12    0
si_supportive_friends_exp    0.13 0.18 0.20 0.18 0.18 0.13    0
si_time_socialising_exp      0.15 0.21 0.22 0.20 0.12 0.10    0</code></pre>
</div>
</div>
<p>The function <code>alpha()</code> returns a lot of information. The most important part, though, is shown at the very beginning:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> raw_alpha std.alpha G6(smc) average_r  S/N  ase mean   sd median_r
      0.85      0.85     0.8      0.66 5.76 0.01 3.46 1.33     0.65</code></pre>
</div>
</div>
<p>In most publications, researchers would primarily report the <code>raw_alpha</code> value. This is fine, but it is not a bad idea to include at least <code>std.alpha</code> and <code>G6(smc)</code> as well.</p>
<p>In terms of interpretation, Cronbrach’s <span class="math inline">\(\alpha\)</span> scores can range from <code>0</code> to <code>1</code>. The closer the score to <code>1</code>, the higher we would judge its reliability. <span class="citation" data-cites="nunally-1967">Nunally (<a href="references.html#ref-nunally-1967" role="doc-biblioref">1967</a>)</span> originally provided the following classification for Cronbach’s <span class="math inline">\(\alpha\)</span>:</p>
<ul>
<li><p>between <code>0.6</code> and <code>0.5</code> can be sufficient during the early stages of development,</p></li>
<li><p><code>0.8</code> or higher is sufficient for most basic research,</p></li>
<li><p><code>0.9</code> or higher is suitable for applied research, where the questionnaires are used to make critical decisions, e.g.&nbsp;clinical studies, university admission tests, etc., with a ‘desired standard’ of <code>0.95</code>.</p></li>
</ul>
<p>However, a few years later, <span class="citation" data-cites="nunally-1978">Nunally (<a href="references.html#ref-nunally-1978" role="doc-biblioref">1978</a>)</span> revisited his original categorisation and considered <code>0.7</code> or higher as a suitable benchmark in more exploratory-type research. This gave grounds for researchers to pick and choose the ‘right’ threshold for them <span class="citation" data-cites="henson2001understanding">(<a href="references.html#ref-henson2001understanding" role="doc-biblioref">Henson 2001</a>)</span>. Consequently, depending on your research field, the expected reliability score might lean more towards <code>0.7</code> or <code>0.8</code>. Still, the higher the score, the more reliable you latent variable is.</p>
<p>Our dataset shows that <code>si</code> scores a solid <span class="math inline">\(\alpha = 0.85\)</span>, which is excellent. We should repeat this step for <code>cs_imp</code> and <code>cs_exp</code> as well. However, we have to adjust <code>select()</code>, because we only want variables included that start with <code>cs_</code> and end with the facet of the respective variable, i.e.&nbsp;<code>_imp</code> or <code>_exp</code>. Otherwise we compute the Cronbach’s <span class="math inline">\(\alpha\)</span> for a combined latent construct.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select variables which start with 'cs_'</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>gep <span class="sc">|&gt;</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"cs_"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 300
Columns: 8
Rowwise: 
$ cs_explain_ideas_imp          &lt;dbl&gt; 6, 5, 5, 5, 5, 5, 4, 5, 6, 6, 5, 5, 4, 6…
$ cs_find_clarification_imp     &lt;dbl&gt; 4, 5, 5, 6, 6, 5, 4, 6, 6, 6, 5, 5, 4, 5…
$ cs_learn_different_styles_imp &lt;dbl&gt; 6, 5, 6, 4, 4, 4, 4, 6, 6, 6, 4, 5, 5, 5…
$ cs_explain_ideas_exp          &lt;dbl&gt; 6, 5, 2, 5, 6, 5, 6, 6, 6, 6, 4, 4, 3, 6…
$ cs_find_clarification_exp     &lt;dbl&gt; 6, 5, 4, 6, 6, 5, 6, 6, 6, 6, 2, 5, 4, 5…
$ cs_learn_different_styles_exp &lt;dbl&gt; 6, 4, 5, 4, 6, 3, 5, 6, 6, 6, 2, 4, 2, 5…
$ cs_imp                        &lt;dbl&gt; 5.333333, 5.000000, 5.333333, 5.000000, …
$ cs_exp                        &lt;dbl&gt; 6.000000, 4.666667, 3.666667, 5.000000, …</code></pre>
</div>
</div>
<p>Therefore it is necessary to define two conditions to select the correct items in our dataset using <code>ends_with()</code> and combine these two with the logical operator <code>&amp;</code> (see also <a href="05_r_basics.html#tbl-logical-operators-r" class="quarto-xref">Table&nbsp;<span>5.1</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Do the above but include only variables that also end with '_imp'</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>gep <span class="sc">|&gt;</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"cs_"</span>) <span class="sc">&amp;</span> <span class="fu">ends_with</span>(<span class="st">"_imp"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 300
Columns: 4
Rowwise: 
$ cs_explain_ideas_imp          &lt;dbl&gt; 6, 5, 5, 5, 5, 5, 4, 5, 6, 6, 5, 5, 4, 6…
$ cs_find_clarification_imp     &lt;dbl&gt; 4, 5, 5, 6, 6, 5, 4, 6, 6, 6, 5, 5, 4, 5…
$ cs_learn_different_styles_imp &lt;dbl&gt; 6, 5, 6, 4, 4, 4, 4, 6, 6, 6, 4, 5, 5, 5…
$ cs_imp                        &lt;dbl&gt; 5.333333, 5.000000, 5.333333, 5.000000, …</code></pre>
</div>
</div>
<p>We also created a variable that starts with <code>cs_</code> and ends with <code>_imp</code>, i.e.&nbsp;the latent variable we computed, which also has to be removed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove 'cs_imp', because it is the computed latent variable</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>gep <span class="sc">|&gt;</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"cs_"</span>) <span class="sc">&amp;</span> <span class="fu">ends_with</span>(<span class="st">"_imp"</span>), <span class="sc">-</span>cs_imp) <span class="sc">|&gt;</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 300
Columns: 3
Rowwise: 
$ cs_explain_ideas_imp          &lt;dbl&gt; 6, 5, 5, 5, 5, 5, 4, 5, 6, 6, 5, 5, 4, 6…
$ cs_find_clarification_imp     &lt;dbl&gt; 4, 5, 5, 6, 6, 5, 4, 6, 6, 6, 5, 5, 4, 5…
$ cs_learn_different_styles_imp &lt;dbl&gt; 6, 5, 6, 4, 4, 4, 4, 6, 6, 6, 4, 5, 5, 5…</code></pre>
</div>
</div>
<p>Thus, we end up computing the Cronbach’s <span class="math inline">\(\alpha\)</span> for both variables in the following way:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>gep <span class="sc">|&gt;</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"cs_"</span>) <span class="sc">&amp;</span> <span class="fu">ends_with</span>(<span class="st">"_imp"</span>), <span class="sc">-</span>cs_imp) <span class="sc">|&gt;</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  psych<span class="sc">::</span><span class="fu">alpha</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Reliability analysis   
Call: psych::alpha(x = select(gep, starts_with("cs_") &amp; ends_with("_imp"), 
    -cs_imp))

  raw_alpha std.alpha G6(smc) average_r S/N   ase mean   sd median_r
      0.86      0.87    0.82      0.68 6.5 0.014    5 0.98     0.65

    95% confidence boundaries 
         lower alpha upper
Feldt     0.83  0.86  0.89
Duhachek  0.84  0.86  0.89

 Reliability if an item is dropped:
                              raw_alpha std.alpha G6(smc) average_r S/N
cs_explain_ideas_imp               0.78      0.78    0.65      0.65 3.6
cs_find_clarification_imp          0.76      0.76    0.62      0.62 3.2
cs_learn_different_styles_imp      0.88      0.88    0.79      0.79 7.4
                              alpha se var.r med.r
cs_explain_ideas_imp             0.025    NA  0.65
cs_find_clarification_imp        0.028    NA  0.62
cs_learn_different_styles_imp    0.014    NA  0.79

 Item statistics 
                                n raw.r std.r r.cor r.drop mean  sd
cs_explain_ideas_imp          300  0.90  0.90  0.85   0.77  5.2 1.0
cs_find_clarification_imp     300  0.91  0.91  0.87   0.79  5.1 1.1
cs_learn_different_styles_imp 300  0.86  0.85  0.71   0.67  4.8 1.2

Non missing response frequency for each item
                                 1    2    3    4    5    6 miss
cs_explain_ideas_imp          0.01 0.01 0.06 0.14 0.27 0.51    0
cs_find_clarification_imp     0.01 0.02 0.05 0.14 0.30 0.47    0
cs_learn_different_styles_imp 0.01 0.03 0.09 0.19 0.31 0.36    0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>gep <span class="sc">|&gt;</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"cs_"</span>) <span class="sc">&amp;</span> <span class="fu">ends_with</span>(<span class="st">"_exp"</span>), <span class="sc">-</span>cs_exp) <span class="sc">|&gt;</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  psych<span class="sc">::</span><span class="fu">alpha</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Reliability analysis   
Call: psych::alpha(x = select(gep, starts_with("cs_") &amp; ends_with("_exp"), 
    -cs_exp))

  raw_alpha std.alpha G6(smc) average_r S/N   ase mean  sd median_r
      0.81      0.82    0.76       0.6 4.4 0.019  4.2 1.1     0.58

    95% confidence boundaries 
         lower alpha upper
Feldt     0.77  0.81  0.85
Duhachek  0.78  0.81  0.85

 Reliability if an item is dropped:
                              raw_alpha std.alpha G6(smc) average_r S/N
cs_explain_ideas_exp               0.69      0.69    0.53      0.53 2.3
cs_find_clarification_exp          0.73      0.74    0.58      0.58 2.8
cs_learn_different_styles_exp      0.81      0.81    0.68      0.68 4.2
                              alpha se var.r med.r
cs_explain_ideas_exp             0.035    NA  0.53
cs_find_clarification_exp        0.031    NA  0.58
cs_learn_different_styles_exp    0.022    NA  0.68

 Item statistics 
                                n raw.r std.r r.cor r.drop mean  sd
cs_explain_ideas_exp          300  0.88  0.88  0.80   0.71  4.2 1.3
cs_find_clarification_exp     300  0.85  0.86  0.76   0.68  4.5 1.2
cs_learn_different_styles_exp 300  0.84  0.82  0.67   0.61  4.0 1.4

Non missing response frequency for each item
                                 1    2    3    4    5    6 miss
cs_explain_ideas_exp          0.04 0.09 0.11 0.33 0.26 0.17    0
cs_find_clarification_exp     0.02 0.05 0.13 0.27 0.32 0.21    0
cs_learn_different_styles_exp 0.06 0.09 0.21 0.24 0.22 0.17    0</code></pre>
</div>
</div>
<p>Similarly, to <code>si</code>, <code>cs_imp</code> and <code>cs_exp</code> show very good internal consistency scores: <span class="math inline">\(\alpha_{cs\_imp} = 0.86\)</span> and <span class="math inline">\(\alpha_{cs\_exp} = 0.81\)</span>. Based on these results we could be confident to use our latent variables for further analysis.</p>
</section>
<section id="sec-efa-and-cfa" class="level3" data-number="7.8.3">
<h3 data-number="7.8.3" class="anchored" data-anchor-id="sec-efa-and-cfa"><span class="header-section-number">7.8.3</span> Confirmatory factor analysis</h3>
<p>However, while Cronbach’s <span class="math inline">\(\alpha\)</span> is very popular due to its simplicity, there is plenty of criticism. Therefore, it is often not enough to report the Cronbach’s <span class="math inline">\(\alpha\)</span>, but undertake additional steps. Depending on the stage of development of your measurement instrument (e.g.&nbsp;your questionnaire), you likely have to perform one of the following before computing the <span class="math inline">\(\alpha\)</span> scores:</p>
<ul>
<li><p><em>Exploratory factor analysis (EFA)</em>: Generally used to identify latent variables in a set of questionnaire items. Often these latent variables are not yet known. This process is often referred to as <em>dimension reduction</em>.</p></li>
<li><p><em>Confirmatory factor analysis (CFA)</em>: This approach is used to confirm whether a set of items truly reflect a latent variable which we defined ex-ante.</p></li>
</ul>
<p>During the development of a new questionnaire, researchers often perform EFA on a pilot dataset to see which factors would emerge without prior assumptions. Once this process has been completed, another round of data would be collected to perform a CFA. This CFA ideally confirms the results from the pilot study. It is also not unusual to split a larger dataset into two parts and then perform EFA and CFA on separate sub-samples. However, this latter approach has the disadvantage that researchers would not have the opportunity to improve the questionnaire between EFA and CFA.</p>
<p>Since the <code>gep</code> data is based on an established measurement tool, we perform a CFA. To perform a CFA, we use the popular <code>lavaan</code> (<u><em>La</em></u><em>tent <u>Va</u>riable <u>An</u>alysis</em>) package. The steps of running a CFA in <em>R</em> include:</p>
<ol type="1">
<li><p>Define which variables are supposed to measure a specific latent variable (i.e.&nbsp;creating a model).</p></li>
<li><p>Run the CFA to see whether our model fits the data we collected.</p></li>
<li><p>Interpret the results based on various indicators.</p></li>
</ol>
<p>The code chunk below breaks down these steps in the context of the <code>lavaan</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lavaan)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="co">#1: Define the model which explains how items relate to latent variables</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="st">'</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="st">social_integration =~</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="st">si_socialise_with_people_exp +</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="st">si_supportive_friends_exp +</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="st">si_time_socialising_exp</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="st">comm_skills_imp =~</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="st">cs_explain_ideas_imp +</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a><span class="st">cs_find_clarification_imp +</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="st">cs_learn_different_styles_imp</span></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a><span class="st">comm_skills_exp =~</span></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a><span class="st">cs_explain_ideas_exp +</span></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a><span class="st">cs_find_clarification_exp +</span></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a><span class="st">cs_learn_different_styles_exp</span></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a><span class="co">#2: Run the CFA to see how well this model fits our data</span></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">cfa</span>(model, <span class="at">data =</span> gep)</span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a><span class="co">#3a: Extract the performance indicators</span></span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a>fit_indices <span class="ot">&lt;-</span> <span class="fu">fitmeasures</span>(fit)</span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a><span class="co">#3b: We tidy the results with enframe() and</span></span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a><span class="co">#    pick only those indices we are most interested in</span></span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a>fit_indices <span class="sc">|&gt;</span></span>
<span id="cb128-30"><a href="#cb128-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enframe</span>() <span class="sc">|&gt;</span></span>
<span id="cb128-31"><a href="#cb128-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"cfi"</span> <span class="sc">|</span></span>
<span id="cb128-32"><a href="#cb128-32" aria-hidden="true" tabindex="-1"></a>         name <span class="sc">==</span> <span class="st">"srmr"</span> <span class="sc">|</span></span>
<span id="cb128-33"><a href="#cb128-33" aria-hidden="true" tabindex="-1"></a>         name <span class="sc">==</span> <span class="st">"rmsea"</span>) <span class="sc">|&gt;</span></span>
<span id="cb128-34"><a href="#cb128-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">round</span>(value, <span class="dv">3</span>))   <span class="co"># Round to 3 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  name  value     
  &lt;chr&gt; &lt;lvn.vctr&gt;
1 cfi   0.967     
2 rmsea 0.081     
3 srmr  0.037     </code></pre>
</div>
</div>
<p>The <code>enframe()</code> function is useful to turn a named vector (i.e.&nbsp;a named sequence of values) into a <code>tibble</code>, which we can further manipulate using the functions we already know. However, it is not required to take this step to inspect the results. This can be done out of pure convenience. If we want to know where <code>name</code> and <code>value</code> came from we have to inspect the output from <code>enframe(fit_indices)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">enframe</span>(fit_indices)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 46 × 2
   name            value       
   &lt;chr&gt;           &lt;lvn.vctr&gt;  
 1 npar            2.100000e+01
 2 fmin            1.177732e-01
 3 chisq           7.066390e+01
 4 df              2.400000e+01
 5 pvalue          1.733810e-06
 6 baseline.chisq  1.429729e+03
 7 baseline.df     3.600000e+01
 8 baseline.pvalue 0.000000e+00
 9 cfi             9.665187e-01
10 tli             9.497780e-01
# ℹ 36 more rows</code></pre>
</div>
</div>
<p>These column names were generated when we called the function <code>enframe()</code>. I often find myself working through chains of analytical steps iteratively to see what the intermediary steps produce. This also makes it easier to spot any mistakes early on. Therefore, I recommend slowly building up your <code>dplyr</code> chains of function calls, especially when you just started learning <em>R</em> and the <code>tidyverse</code> approach of data analysis.</p>
<p>The results of our CFA appear fairly promising:</p>
<ul>
<li><p>The <code>cfi</code> (<em>Comparative Fit Index</em>) lies above <code>0.95</code>,</p></li>
<li><p>The <code>rmsea</code> (<em>Root Mean Square Error of Approximation</em>) appears slightly higher than desirable, which usually is lower than <code>0.6</code>, and</p></li>
<li><p>The <code>srmr</code> (<em>Standardised Root Mean Square Residual</em>) lies well below <code>0.08</code> <span class="citation" data-cites="west2012model hu-bentler-1999cutoff">(<a href="references.html#ref-west2012model" role="doc-biblioref">West et al. 2012</a>; <a href="references.html#ref-hu-bentler-1999cutoff" role="doc-biblioref">Hu and Bentler 1999</a>)</span>.</p></li>
</ul>
<p>Overall, the model seems to suggest a good fit with our data. Combined with the computed Cronbach’s <span class="math inline">\(\alpha\)</span>, we can be reasonably confident in our latent variables and perform further analytical steps.</p>
</section>
<section id="sec-reversing-items-with-opposite-meaning" class="level3" data-number="7.8.4">
<h3 data-number="7.8.4" class="anchored" data-anchor-id="sec-reversing-items-with-opposite-meaning"><span class="header-section-number">7.8.4</span> Reversing items with opposite meaning</h3>
<p>Questionnaires like the <code>gep</code> consist of items that are all phrased in the ‘same direction’. What I mean by this is that all questions are asked so that a high score would carry the same meaning. However, this is not always true. Consider the following three questions as an example:</p>
<ul>
<li><p>Q1: <em>‘I enjoy talking to people I don’t know.’</em></p></li>
<li><p>Q2: <em>‘I prefer to stay at home.’</em></p></li>
<li><p>Q3: <em>‘Making new friends is exciting.’</em></p></li>
</ul>
<p>Q1 and Q3 both refer to aspects of socialising with or getting to know others. Q2, however, seems to ask for the opposite, i.e.&nbsp;not engaging with others and staying at home. Intuitively, we would assume that a participant who scores high on Q1 and Q2 would score low on Q3. Q3 is a so-called <em>reversed item</em>, i.e.&nbsp;the meaning of the question is reversed compared to other questions in this set. This strategy is commonly used to test for respondents’ engagement with a questionnaire and break a possible response pattern. For example, if a participant scores 5 out of 6 on Q1, Q2 and Q3, we have to assume that this person might not have paid much attention to the statements because someone who scores high on Q1 and Q3 would likely not score high on Q2. However, their usefulness is debated across disciplines. When designing your data collection tool, items must be easy to understand, short, not double-barreled and reflect a facet of a latent variable appropriately. These aspects are far more important than reversing the meaning of items.</p>
<p>Suppose we work with a dataset containing reversed items. In that case, we have to recode the answers for each participant to reflect the same meaning as the other questions before computing the Cronbach’s <span class="math inline">\(\alpha\)</span> or performing an EFA or CFA.</p>
<p>Let’s assume we ask some of our friends to rate Q1, Q2 and Q3 on a scale from 1-6. We might obtain the following results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>df_social <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Agatha Harkness"</span>, <span class="st">"Daren Cross"</span>, <span class="st">"Hela"</span>,</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Aldrich Killian"</span>, <span class="st">"Malekith"</span>, <span class="st">"Ayesha"</span>),</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">q1 =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">2</span>),</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">q2 =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>),</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">q3 =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>))</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>df_social</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  name               q1    q2    q3
  &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Agatha Harkness     6     2     5
2 Daren Cross         2     5     1
3 Hela                4     1     5
4 Aldrich Killian     5     2     4
5 Malekith            5     3     5
6 Ayesha              2     6     1</code></pre>
</div>
</div>
<p>While, for example, <code>Agatha Harkness</code> and <code>Aldrich Killian</code> are both very social, <code>Ayesha</code> seems to be rather the opposite. For all of our respondents, we can notice a pattern that if the value of <code>q1</code> is high, usually <code>q3</code> is high too, but <code>q2</code> is low. We would be very disappointed and probably puzzled if we now computed the Cronbach’s <span class="math inline">\(\alpha\)</span> of our latent variable <code>social</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cronbach's alpha without reverse coding q2</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>df_social <span class="sc">|&gt;</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">|&gt;</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  psych<span class="sc">::</span><span class="fu">alpha</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in psych::alpha(select(df_social, -name)): Some items were negatively correlated with the first principal component and probably 
should be reversed.  
To do this, run the function again with the 'check.keys=TRUE' option</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Some items ( q2 ) were negatively correlated with the first principal component and 
probably should be reversed.  
To do this, run the function again with the 'check.keys=TRUE' option</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Reliability analysis   
Call: psych::alpha(x = select(df_social, -name))

  raw_alpha std.alpha G6(smc) average_r   S/N ase mean   sd median_r
      -2.2      -1.7     0.7     -0.27 -0.64 1.7  3.6 0.69     -0.8

    95% confidence boundaries 
          lower alpha upper
Feldt    -12.47 -2.18  0.52
Duhachek  -5.49 -2.18  1.13

 Reliability if an item is dropped:
   raw_alpha std.alpha G6(smc) average_r   S/N alpha se var.r med.r
q1    -21.00    -21.04   -0.91     -0.91 -0.95   17.947    NA -0.91
q2      0.94      0.95    0.91      0.91 19.70    0.042    NA  0.91
q3     -7.61     -8.03   -0.80     -0.80 -0.89    6.823    NA -0.80

 Item statistics 
   n raw.r std.r r.cor r.drop mean  sd
q1 6  0.93  0.94  0.95   0.29  4.0 1.7
q2 6 -0.58 -0.61 -0.89  -0.88  3.2 1.9
q3 6  0.83  0.84  0.93  -0.22  3.5 2.0

Non missing response frequency for each item
      1    2    3    4    5    6 miss
q1 0.00 0.33 0.00 0.17 0.33 0.17    0
q2 0.17 0.33 0.17 0.00 0.17 0.17    0
q3 0.33 0.00 0.00 0.17 0.50 0.00    0</code></pre>
</div>
</div>
<p>The function <code>alpha()</code> is clever enough to make us aware that something went wrong. It even tells us that <code>Some items ( q2 ) were negatively correlated with the total scale and probably should be reversed</code>. Also, the Cronbach’s <span class="math inline">\(\alpha\)</span> is now negative, which is another indicator that reversed items might be present in the dataset. To remedy this problem, we have to recode <code>q2</code> to reflect the opposite meaning. Inverting the coding usually implies we have to mirror the scores, i.e.&nbsp;the largest value become the smallest one and vice versa. Since we use a 6-point Likert scale, we have to recode values in the following way:</p>
<ul>
<li><code>6</code> -&gt; <code>1</code></li>
<li><code>5</code> -&gt; <code>2</code></li>
<li><code>4</code> -&gt; <code>3</code></li>
<li><code>3</code> -&gt; <code>4</code></li>
<li><code>2</code> -&gt; <code>5</code></li>
<li><code>1</code> -&gt; <code>6</code></li>
</ul>
<p>As is so often the case in <em>R</em>, there is more than just one way of achieving this:</p>
<ul>
<li><p>Compute a new variable with <code>mutate()</code> only,</p></li>
<li><p>Apply <code>recode()</code> to the variable in question, or</p></li>
<li><p>Use the <code>psych</code> package.</p></li>
</ul>
<p>I will introduce you to all three methods, because each comes with their own benefits and drawbacks. Thus, for me, it is very context-specific.</p>
<section id="sec-reversing-items-mutate" class="level4" data-number="7.8.4.1">
<h4 data-number="7.8.4.1" class="anchored" data-anchor-id="sec-reversing-items-mutate"><span class="header-section-number">7.8.4.1</span> Reversing items with <code>mutate()</code></h4>
<p>Let us begin with the method that is my favourite because it is very quick to execute and only requires one function. With <code>mutate()</code>, we can calculate the reversed score for an item by applying the following formula:<span class="math display">\[score_{reversed} = score_{max} + score_{min} - score_{obs}\]</span></p>
<p>In other words, the reversed score <span class="math inline">\(score_{reversed}\)</span> of an item equals the theoretical maximum score on a given scale <span class="math inline">\(score_{max}\)</span> plus the theoretical minimum score on this scale <span class="math inline">\(score_{min}\)</span>, and then we subtract the observed score <span class="math inline">\(score_{obs}\)</span>, i.e.&nbsp;the actual response by our participant. For example, if someone in our study scored a <code>5</code> on <code>q2</code>, we could compute the reversed score as follows: <code>6 + 1 - 5 = 2</code> because our Likert scale ranges from <code>1</code> to <code>6</code>. In <em>R</em>, we can apply this idea to achieve this for multiple observations at once.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>df_social_r <span class="ot">&lt;-</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>  df_social <span class="sc">|&gt;</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">q2_r =</span> <span class="dv">7</span> <span class="sc">-</span> q2)</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>df_social_r <span class="sc">|&gt;</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(q2, q2_r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
     q2  q2_r
  &lt;dbl&gt; &lt;dbl&gt;
1     2     5
2     5     2
3     1     6
4     2     5
5     3     4
6     6     1</code></pre>
</div>
</div>
<p>This technique is simple, flexible and easy to read and understand. We can change this formula to fit any scale length and make adjustments accordingly. I strongly recommend starting with this approach before opting for one of the other two.</p>
</section>
<section id="sec-reversing-items-recode" class="level4" data-number="7.8.4.2">
<h4 data-number="7.8.4.2" class="anchored" data-anchor-id="sec-reversing-items-recode"><span class="header-section-number">7.8.4.2</span> Reversing items with <code>recode()</code></h4>
<p>Another option to reverse items is <code>recode()</code>. Conceptually, <code>recode()</code> functions similarly to <code>fct_recode()</code>, only that it can handle numbers and factors. Therefore, we can apply a similar strategy as we did before with factors (see <a href="#sec-recoding-factors" class="quarto-xref"><span>Section 7.5.1</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>df_social_r <span class="ot">&lt;-</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  df_social <span class="sc">|&gt;</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">q2_r =</span> <span class="fu">recode</span>(q2,</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"3"</span>,</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"4"</span>,</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"5"</span>,</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"6"</span>)</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>df_social_r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  name               q1    q2    q3 q2_r 
  &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
1 Agatha Harkness     6     2     5 5    
2 Daren Cross         2     5     1 2    
3 Hela                4     1     5 6    
4 Aldrich Killian     5     2     4 5    
5 Malekith            5     3     5 4    
6 Ayesha              2     6     1 1    </code></pre>
</div>
</div>
<p>While this might seem convenient, it requires more coding and is, therefore, more prone to errors. If we had to do this for multiple items, this technique is not ideal. However, it is a great option whenever you need to change values to something entirely customised, e.g.&nbsp;every <code>6</code> needs to be come a <code>10</code> and every <code>3</code> needs to become a <code>6</code>. However, such cases are rather rare in my experience.</p>
<p>Be aware, that after using <code>recode()</code>, your variable becomes a <code>chr</code>, and you likely have to convert it back to a numeric data type. We can adjust the above code to achieve recoding and converting in one step.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>df_social_r <span class="ot">&lt;-</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  df_social <span class="sc">|&gt;</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">q2_r =</span> <span class="fu">as.numeric</span>(<span class="fu">recode</span>(q2,</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"3"</span>,</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"4"</span>,</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"5"</span>,</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"6"</span>))</span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>df_social_r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  name               q1    q2    q3  q2_r
  &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Agatha Harkness     6     2     5     5
2 Daren Cross         2     5     1     2
3 Hela                4     1     5     6
4 Aldrich Killian     5     2     4     5
5 Malekith            5     3     5     4
6 Ayesha              2     6     1     1</code></pre>
</div>
</div>
</section>
<section id="sec-reversing-items-psych" class="level4" data-number="7.8.4.3">
<h4 data-number="7.8.4.3" class="anchored" data-anchor-id="sec-reversing-items-psych"><span class="header-section-number">7.8.4.3</span> Reversing items with the <code>psych</code> package</h4>
<p>The last option I would like to share with you is with the <code>psych</code> package. This option can be helpful when reversing multiple items at once without having to create additional variables. The function <code>reverse.code()</code> takes a dataset with items and requires the specification of a coding key, i.e.&nbsp;<code>keys</code>. This coding key indicates whether an item in this dataset should be reversed or not by using <code>1</code> for items that should not be reversed and <code>-1</code> for items you wish to reverse.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>items <span class="ot">&lt;-</span> df_social <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>name)</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>df_social_r <span class="ot">&lt;-</span> psych<span class="sc">::</span><span class="fu">reverse.code</span>(<span class="at">keys =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">items =</span> items,</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">mini =</span> <span class="dv">1</span>,</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">maxi =</span> <span class="dv">6</span>)</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>df_social_r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     q1 q2- q3
[1,]  6   5  5
[2,]  2   2  1
[3,]  4   6  5
[4,]  5   5  4
[5,]  5   4  5
[6,]  2   1  1</code></pre>
</div>
</div>
</section>
<section id="sec-reversing-items-final-remark" class="level4" data-number="7.8.4.4">
<h4 data-number="7.8.4.4" class="anchored" data-anchor-id="sec-reversing-items-final-remark"><span class="header-section-number">7.8.4.4</span> A final remark about reversing item scores</h4>
<p>No matter which method we used, we successfully converted the scores from <code>q2</code> and stored them in a new variable <code>q2_r</code> or, in the case of the <code>psych</code> package, as <code>q2-</code>. We can now perform the internal consistency analysis again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cronbach's alpha after reverse coding q2</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>df_social_r <span class="sc">|&gt;</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name, <span class="sc">-</span>q2) <span class="sc">|&gt;</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>  psych<span class="sc">::</span><span class="fu">alpha</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Reliability analysis   
Call: psych::alpha(x = select(df_social_r, -name, -q2))

  raw_alpha std.alpha G6(smc) average_r S/N   ase mean  sd median_r
      0.95      0.95    0.95      0.87  21 0.033  3.8 1.8     0.91

    95% confidence boundaries 
         lower alpha upper
Feldt     0.80  0.95  0.99
Duhachek  0.89  0.95  1.02

 Reliability if an item is dropped:
     raw_alpha std.alpha G6(smc) average_r S/N alpha se var.r med.r
q1        0.95      0.95    0.91      0.91  21    0.037    NA  0.91
q3        0.88      0.89    0.80      0.80   8    0.092    NA  0.80
q2_r      0.94      0.95    0.91      0.91  20    0.042    NA  0.91

 Item statistics 
     n raw.r std.r r.cor r.drop mean  sd
q1   6  0.94  0.94  0.91   0.87  4.0 1.7
q3   6  0.98  0.98  0.98   0.96  3.5 2.0
q2_r 6  0.95  0.95  0.91   0.88  3.8 1.9

Non missing response frequency for each item
        1    2    4    5    6 miss
q1   0.00 0.33 0.17 0.33 0.17    0
q3   0.33 0.00 0.17 0.50 0.00    0
q2_r 0.17 0.17 0.17 0.33 0.17    0</code></pre>
</div>
</div>
<p>Now everything seems to make sense, and the internal consistency is excellent. We can assume that all three questions reflect one latent construct. From here, we can return to computing our latent variables (see <a href="#sec-computing-latent-variables" class="quarto-xref"><span>Section 7.8.1</span></a>) and continue with our analysis.</p>
<p>When working with datasets, especially those you have not generated yourself, it is always important to check whether any items are meant to be reverse coded. Missing this aspect will likely throw many surprising results and can completely ruin your analysis. I vividly remember my PhD supervisor’s story about a viva where a student forgot about reversing their scores. The panellists noticed that the correlations presented were counter-intuitive, and only then it was revealed that the entire analysis had to be redone. Tiny mistakes can often have an enormous ripple effect. Make sure you have ‘reversed items’ on your checklist when performing data cleaning and wrangling.</p>
</section>
</section>
</section>
<section id="sec-conclusion-data-wrangling" class="level2" data-number="7.9">
<h2 data-number="7.9" class="anchored" data-anchor-id="sec-conclusion-data-wrangling"><span class="header-section-number">7.9</span> Once you finished with data wrangling</h2>
<p>Once you finished your data cleaning, I recommend writing (i.e.&nbsp;exporting) your cleaned data out of <em>R</em> into your <em>‘01_tidy_data’</em> folder. You can then use this dataset to continue with your analysis. This way, you do not have to run all your data wrangling and cleaning code every time you open your <em>R</em> project. To write your tidy dataset onto your hard drive of choice, we can use <code>readr</code> in the same way as we did at the <a href="#importing-data-using-functions" title="Import your data using functions">beginning</a> to import data. However, instead of <code>read_csv()</code> we have to use another function that writes the file into a folder. The function <code>write_csv()</code> first takes the name of the object we want to save and then the folder and file name we want to save it to. We only made changes to the <code>wvs</code> dataset and after cleaning and dealing with missing data, we saved it in the object <code>wvs_nona</code>. So we should save it to our hard drive and name it, for example, <code>wvs_nona.csv</code>, because it is not only clean, but also has <em>‘no NA’</em>, i.e.&nbsp;no missing data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(wvs_clean, <span class="st">"01_tidy_data/wvs_nona.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This chapter has been a reasonably long one. Nonetheless, it only covered the basics of what can and should be done when preparing data for analysis. These steps should not be rushed or skipped. It is essential to have the data cleaned appropriately. This process helps you familiarise yourself with the dataset in great depth, and it makes you aware of limitations or even problems of your data. In the spirit of <a href="https://osf.io" target="blank" title="Open Science">Open Science</a>, using <em>R</em> also helps to document the steps you undertook to get from a raw dataset to a tidy one. This is also beneficial if you intend to publish your work later. Reproducibility has become an essential aspect of transparent and impactful research and should be a guiding principle of any empirical research.</p>
<p>Now that we have learned the basics of data wrangling, we can finally start our data analysis.</p>
</section>
<section id="exercises" class="level2" data-number="7.10">
<h2 data-number="7.10" class="anchored" data-anchor-id="exercises"><span class="header-section-number">7.10</span> Exercises</h2>
<p>If you would like to test your knowledge or simply practice what we covered in this chapter you can copy and paste the following code if you have the <code>r4np</code> installed already.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1:</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>learnr<span class="sc">::</span><span class="fu">run_tutorial</span>(<span class="st">"ex_data_wrangling"</span>, <span class="at">package =</span> <span class="st">"r4np"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you have not yet installed the <code>r4np</code> package, you will have to do this first using by using this code chunk:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2:</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"ddauber/r4np"</span>)</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>learnr<span class="sc">::</span><span class="fu">run_tutorial</span>(<span class="st">"ex_data_wrangling"</span>, <span class="at">package =</span> <span class="st">"r4np"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-van-buuren-2018" class="csl-entry" role="listitem">
Buuren, Stef van. 2018. <em>Flexible Imputation of Missing Data</em>. CRC press.
</div>
<div id="ref-dong-et-al-2013" class="csl-entry" role="listitem">
Dong, Yiran, and Chao-Ying Joanne Peng. 2013. <span>“Principled Missing Data Methods for Researchers.”</span> <em>SpringerPlus</em> 2 (1): 1–17.
</div>
<div id="ref-van2020rebutting" class="csl-entry" role="listitem">
Ginkel, Joost R van, Marielle Linting, Ralph CA Rippe, and Anja van der Voort. 2020. <span>“Rebutting Existing Misconceptions about Multiple Imputation as a Method for Handling Missing Data.”</span> <em>Journal of Personality Assessment</em> 102 (3): 297–308.
</div>
<div id="ref-lubridate" class="csl-entry" role="listitem">
Grolemund, Garrett, and Hadley Wickham. 2011. <span>“Dates and Times Made Easy with <span class="nocase">lubridate</span>.”</span> <em>Journal of Statistical Software</em> 40 (3): 1–25. <a href="https://www.jstatsoft.org/v40/i03/">https://www.jstatsoft.org/v40/i03/</a>.
</div>
<div id="ref-wvs2022" class="csl-entry" role="listitem">
Haerpfer, Christian, Ronald Inglehart, Alejandro Moreno, Christian Welzel, Kseniya Kizilova, Jaime Diez-Medrano, Marta Lagos, Pippa Norris, Eduard Ponarin, and Bi Puranen. 2022. <span>“World Values Survey: All Rounds - Country-Pooled Datafile. Madrid, Spain &amp; Vienna, Austria: JD Systems Institute &amp; WVSA Secretariat. Dataset Version 3.0.0.”</span> World Values Survey Association. <a href="https://doi.org/10.14281/18241.17">https://doi.org/10.14281/18241.17</a>.
</div>
<div id="ref-henson2001understanding" class="csl-entry" role="listitem">
Henson, Robin K. 2001. <span>“Understanding Internal Consistency Reliability Estimates: A Conceptual Primer on Coefficient Alpha.”</span> <em>Measurement and Evaluation in Counseling and Development</em> 34 (3): 177–89.
</div>
<div id="ref-hu-bentler-1999cutoff" class="csl-entry" role="listitem">
Hu, Li-tze, and Peter M Bentler. 1999. <span>“Cutoff Criteria for Fit Indexes in Covariance Structure Analysis: Conventional Criteria Versus New Alternatives.”</span> <em>Structural Equation Modeling: A Multidisciplinary Journal</em> 6 (1): 1–55.
</div>
<div id="ref-jakobsen-et-al-2017" class="csl-entry" role="listitem">
Jakobsen, Janus Christian, Christian Gluud, Jørn Wetterslev, and Per Winkel. 2017. <span>“When and How Should Multiple Imputation Be Used for Handling Missing Data in Randomised Clinical Trials–a Practical Guide with Flowcharts.”</span> <em>BMC Medical Research Methodology</em> 17 (1): 1–10.
</div>
<div id="ref-little-1988" class="csl-entry" role="listitem">
Little, Roderick J. A. 1988. <span>“A Test of Missing Completely at Random for Multivariate Data with Missing Values.”</span> <em>Journal of the American Statistical Association</em> 83 (404): 1198–1202. <a href="https://doi.org/10.1080/01621459.1988.10478722">https://doi.org/10.1080/01621459.1988.10478722</a>.
</div>
<div id="ref-data-types-2021" class="csl-entry" role="listitem">
Müller, Kirill, and Hadley Wickham. 2021. <span>“Column Data Types.”</span> <a href="https://tibble.tidyverse.org/articles/types.html">https://tibble.tidyverse.org/articles/types.html</a>.
</div>
<div id="ref-nunally-1967" class="csl-entry" role="listitem">
Nunally, J. C. 1967. <em>Psychometric Theory</em>. New york: Mc Graw-Hill.
</div>
<div id="ref-nunally-1978" class="csl-entry" role="listitem">
———. 1978. <em>Psychometric Theory (2nd Edition)</em>. New york: Mc Graw-Hill.
</div>
<div id="ref-rubin-1976" class="csl-entry" role="listitem">
Rubin, Donald B. 1976. <span>“Inference and Missing Data.”</span> <em>Biometrika</em> 63 (3): 581–92.
</div>
<div id="ref-schafer-1999" class="csl-entry" role="listitem">
Schafer, Joseph L. 1999. <span>“Multiple Imputation: A Primer.”</span> <em>Statistical Methods in Medical Research</em> 8 (1): 3–15.
</div>
<div id="ref-hsbDataWrangling" class="csl-entry" role="listitem">
Stobierski, Tim. 2021. <span>“Data Wrangling: What It Is and Why It’s Important.”</span> Harvard Business School Online. <a href="https://online.hbs.edu/blog/post/data-wrangling">https://online.hbs.edu/blog/post/data-wrangling</a>.
</div>
<div id="ref-west2012model" class="csl-entry" role="listitem">
West, Stephen G, Aaron B Taylor, Wei Wu, et al. 2012. <span>“Model Fit and Model Selection in Structural Equation Modeling.”</span> <em>Handbook of Structural Equation Modeling</em> 1: 209–31.
</div>
<div id="ref-wickham2014tidy" class="csl-entry" role="listitem">
Wickham, Hadley. 2014. <span>“Tidy Data.”</span> <em>Journal of Statistical Software</em> 59 (1): 1–23.
</div>
<div id="ref-wickham-2021" class="csl-entry" role="listitem">
———. 2021. <em>The Tidyverse Style Guide</em>. <a href="https://style.tidyverse.org">https://style.tidyverse.org</a>.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>A sophisticated research project would likely not rely on a dichotomous approach to gender, but appreciate the diversity in this regard.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Still, I understand that it often feels annoying.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Technically, there are many more options, but most of them work similar to the demonstrated techniques and are equally less needed in most scenarios.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./06_starting_r_projects.html" class="pagination-link  aria-label=" &lt;span="" your="" *r*="" projects&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Starting your <em>R</em> projects</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08_descriptive_statistics.html" class="pagination-link" aria-label="<span class='chapter-number'>8</span>&nbsp; <span class='chapter-title'>Descriptive Statistics</span>">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Descriptive Statistics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>